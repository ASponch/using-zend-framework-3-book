<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework 3">
<meta name="keywords" content="zend framework book,free zend framework book,zf3 book,free zf3 book,zend book">
<meta name="author" content="(c) 2016 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../favicon.ico" rel="shortcut icon" type="image/ico" />
<link rel="preload" href="../assets/css/prism.css" as="style" onload="this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="../assets/css/prism.css"></noscript>
<link href="../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Collecting User Input with Forms -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework 3            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="Page_Appearance_and_Layout.html">
            <img alt="Previous Chapter" src="../assets/images/left.png"><span>Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="toc.html">
            <img alt="Contents" src="../assets/images/book.png"><span>Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="Transforming_Input_Data_with_Filters.html">
            <span>Next</span><img alt="Next Chapter" src="../assets/images/right.png">
        </a>
            </div>    
</div>

ï»¿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<h1 id="forms">7. Collecting User Input with Forms</h1>
<p>In this chapter, you will become familiar with using web forms for gathering data 
entered by site users. In Zend Framework 3, functionality 
for working with forms is mainly spread across four components: the <code>Zend\Form</code> component, 
which allows you to build forms and contains the view helpers for rendering form elements; 
the <code>Zend\Filter</code>, <code>Zend\Validator</code> and <code>Zend\InputFilter</code> components which allow you to filter 
and validate user input:</p>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th> <em>Component</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Zend\Form</code>                    </td>
<td>  Contains base form model classes.                             </td>
</tr>
<tr>
<td> <code>Zend\Filter</code>                  </td>
<td> Contains various filters classes.                             </td>
</tr>
<tr>
<td> <code>Zend\Validator</code>               </td>
<td> Implements various validator classes.                         </td>
</tr>
<tr>
<td> <code>Zend\InputFilter</code>             </td>
<td> Implements a container for filters/validators.                </td>
</tr>
<tr>
<td> <code>Zend\Mail</code>                    </td>
<td> Contains E-mail sending functionality.                        </td>
</tr>
</tbody>
</table>
</div>
<h2 id="header-143">7.1. Get the Form Demo Sample from GitHub</h2>
<p>We will demonstrate form usage on the <em>Form Demo</em> sample web application
bundled with the book. This sample is a complete web site you can install 
and see the working forms in action.</p>
<p>To download the <em>Form Demo</em> application, visit 
<a href="https://github.com/olegkrivtsov/using-zf3-book-samples">this page</a>
and click the <em>Clone or Download</em> button to download the code as a ZIP archive. 
When the download is complete, unpack the archive to a directory of your choosing.</p>
<p>Then navigate to the <code>formdemo</code> directory which contains the complete 
source code of the <em>Form Demo</em> web application:</p>
<pre class=""><code class="language-text">/using-zf3-book-samples
  /formdemo
  ...
</code></pre>
<blockquote class="notquote tip" data-type="tip"><p> To install the example, you can either edit your default virtual host file
 or create a new one. After editing the file, restart the Apache HTTP Server
 and open the web site in your web browser. For additional information on
 Apache virtual hosts, you can refer to <a href="Appendix_A__Configuring_Web_Development_Environment.html">Appendix A. Configuring Web Development Environment</a>.</p>
</blockquote><h2 id="header-144">7.2. About HTML Forms</h2>
<p>Form functionality provided by Zend Framework 3 internally uses HTML forms. Because
of that, we start with a brief introduction to HTML forms topic.</p>
<p>In HTML, forms are enclosed with <code>&lt;form&gt;</code> and <code>&lt;/form&gt;</code> tags. A form typically 
consists of fields: text input fields, check boxes, radio buttons, submit buttons, 
hidden fields and so on. HTML provides several tags intended for defining form
fields:</p>
<ul>
<li><code>&lt;input&gt;</code> - specifies an input field where the user can enter 
 some data (field appearance and behavior depends on the field type);</li>
<li><code>&lt;textarea&gt;</code> - multi-line text area which can contain an 
 unlimited number of characters;</li>
<li><code>&lt;button&gt;</code> - a clickable button<sup id="fnref:button"><a href="#fn:button" class="footnote-ref" rel="footnote">17</a></sup>;</li>
<li><code>&lt;select&gt;</code> - a dropdown list;</li>
<li><code>&lt;option&gt;</code> - used inside the <code>&lt;select&gt;</code> element for defining the 
 available options in a dropdown list.</li>
</ul>
<footnotes id="fn:button"><p><sup>17)</sup> The <code>&lt;button&gt;</code> field is analogous to <code>&lt;input type="button"&gt;</code>, however it
provides additional capabilities, like specifying a graphical icon on the button.</p>
</footnotes>
<p>In table 7.1, you can find examples of HTML form field definitions. Figure 7.1 contains
corresponding field visualizations (except the "hidden" field type, which has no visual representation).</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/standard_form_fields.png">
<img src="images/forms/standard_form_fields.png" alt="Figure 7.1. Standard HTML form fields" /></a>
<span class="image-caption">Figure 7.1. Standard HTML form fields</span>
</span>
</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.1. Standard HTML form fields</div><table>
<thead>
<tr>
<th> <em>Field</em>                        </th>
<th> <em>Definition</em>                                                  </th>
</tr>
</thead>
<tbody>
<tr>
<td>  Text input field               </td>
<td>  <code>&lt;input type="text" /&gt;</code>                                       </td>
</tr>
<tr>
<td> Text area                      </td>
<td> <code>&lt;textarea rows=4&gt;&lt;/textarea&gt;</code>                                </td>
</tr>
<tr>
<td> Password                       </td>
<td> <code>&lt;input type="password" /&gt;</code>                                   </td>
</tr>
<tr>
<td> Button                                                          </td>
<td> <code>&lt;input type="button" value="Apply"/&gt;</code> or                       <code>&lt;button type="button"&gt;Apply&lt;/button&gt;</code>                        </td>
</tr>
<tr>
<td> Submit button                  </td>
<td> <code>&lt;input type="submit" value="Submit" /&gt;</code>                      </td>
</tr>
<tr>
<td> Image (graphical submit button)</td>
<td> <code>&lt;input type="image" src="button.jpg" /&gt;</code>                     </td>
</tr>
<tr>
<td> Reset button                   </td>
<td> <code>&lt;input type="reset" value="Reset"/&gt;</code>                         </td>
</tr>
<tr>
<td> Checkbox                       </td>
<td> <code>&lt;input type="checkbox"&gt;Remember me&lt;/input&gt;</code>                  </td>
</tr>
<tr>
<td> Radio                          </td>
<td> <code>&lt;input type="radio" value="Radio"&gt;Allow&lt;/input&gt;</code>             </td>
</tr>
<tr>
<td> Select                         </td>
<td> <code>&lt;select&gt;&lt;option&gt;Enable&lt;/option&gt;&lt;option&gt;Disable&lt;/option&gt;&lt;/select&gt;</code> </td>
</tr>
<tr>
<td> File                           </td>
<td> <code>&lt;input type="file" /&gt;</code>                                       </td>
</tr>
<tr>
<td> Hidden field                   </td>
<td> <code>&lt;input type="hidden" /&gt;</code>                                     </td>
</tr>
</tbody>
</table>
</div>
<p>HTML5 introduced several new form field types (listed in table 7.2); figure 7.2 contains corresponding
field visualizations. </p>
<p>HTML5 fields provide more convenient ways for entering the most frequently used data types: 
numbers, dates, E-mails, URLs, etc. Additionally, on form submit, the web browser 
validates that the user entered data is in a correct format, and if not the browser will 
prevent form submission and ask the user to correct the input error.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.2. HTML5 form fields</div><table>
<thead>
<tr>
<th> <em>Field</em>                        </th>
<th> <em>Definition</em>                                                  </th>
</tr>
</thead>
<tbody>
<tr>
<td>  Color picker                   </td>
<td>  <code>&lt;input type="color" /&gt;</code>                                      </td>
</tr>
<tr>
<td> Date                           </td>
<td> <code>&lt;input type="date" /&gt;</code>                                       </td>
</tr>
<tr>
<td> Date-time (with time zone)     </td>
<td> <code>&lt;input type="datetime" /&gt;</code>                                   </td>
</tr>
<tr>
<td> Date-time (without time zone)  </td>
<td> <code>&lt;input type="datetime-local" /&gt;</code>                             </td>
</tr>
<tr>
<td> E-mail address                 </td>
<td> <code>&lt;input type="email" /&gt;</code>                                      </td>
</tr>
<tr>
<td> Number                         </td>
<td> <code>&lt;input type="number" /&gt;</code>                                     </td>
</tr>
<tr>
<td> Time                           </td>
<td> <code>&lt;input type="time" /&gt;</code>                                       </td>
</tr>
<tr>
<td> Month                          </td>
<td> <code>&lt;input type="month" /&gt;</code>                                      </td>
</tr>
<tr>
<td> Week                           </td>
<td> <code>&lt;input type="week" /&gt;</code>                                       </td>
</tr>
<tr>
<td> URL                            </td>
<td> <code>&lt;input type="url" /&gt;</code>                                        </td>
</tr>
<tr>
<td> Range (slider)                 </td>
<td> <code>&lt;input type="range" /&gt;</code>                                      </td>
</tr>
<tr>
<td> Search field                   </td>
<td> <code>&lt;input type="search" name="googlesearch" /&gt;</code>                 </td>
</tr>
<tr>
<td> Telephone number               </td>
<td> <code>&lt;input type="tel" /&gt;</code>                                        </td>
</tr>
</tbody>
</table>
</div>
<blockquote class="notquote information" data-type="information"><p> At the moment of writing this chapter, not all modern web browsers completely support
 HTML5 form fields. </p>
</blockquote><p><span class="image-wrapper">
<a target="_blank" href="images/forms/html5_form_fields.png">
<img src="images/forms/html5_form_fields.png" alt="Figure 7.2. HTML5 form fields" /></a>
<span class="image-caption">Figure 7.2. HTML5 form fields</span>
</span>
</p>
<h3 id="header-145">7.2.1. Fieldsets</h3>
<p>You can group related form fields with the help of the <code>&lt;fieldset&gt;</code> tag, as shown in the
example below. The optional <code>&lt;legend&gt;</code> tag allows you to define the caption for the group.</p>
<pre class=""><code class="language-html">&lt;fieldset&gt;
  &lt;legend&gt;Choose a payment method:&lt;/legend&gt;
  &lt;input type="radio" name="payment" value="paypal"&gt;PayPal&lt;/input&gt;
  &lt;input type="radio" name="payment" value="card"&gt;Credit Card&lt;/input&gt;
&lt;/fieldset&gt;
</code></pre>
<p>The HTML markup presented above will generate the group as in figure 7.3:</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/fieldset.png">
<img src="images/forms/fieldset.png" alt="Figure 7.3. Fieldset" /></a>
<span class="image-caption">Figure 7.3. Fieldset</span>
</span>
</p>
<h3 id="header-146">7.2.2. Example: "Contact Us" Form</h3>
<p>An example of a typical HTML form is presented below:</p>
<pre class="line-numbers"><code class="language-html">&lt;form name="contact-form" action="/contactus" method="post"&gt; 
  &lt;label for="email"&gt;E-mail&lt;/label&gt;
  &lt;input name="email" type="text"&gt;                              
  &lt;br&gt;        
  &lt;label for="subject"&gt;Subject&lt;/label&gt;            
  &lt;input name="subject" type="text"&gt;                              
  &lt;br&gt;                
  &lt;label for="body"&gt;Message&lt;/label&gt;            
  &lt;textarea name="body" class="form-control" rows="6"&gt;&lt;/textarea&gt;
  &lt;br&gt;              
  &lt;input name="submit" type="submit" value="Submit"&gt;       
&lt;/form&gt;
</code></pre>
<p>In the example above, we have the feedback form which allows the 
user to enter his E-mail address, message subject, text, and then submit them to the server. The 
form definition begins with the <code>&lt;form&gt;</code> tag (line 1).</p>
<p>The <code>&lt;form&gt;</code> tag contains several important attributes:</p>
<ul>
<li>the <code>name</code> attribute specifies the name of the form ("contact-form").</li>
<li>the <code>action</code> attribute defines the URL of the server-side script which is 
responsible for processing the submitted form ("/contactus").</li>
<li>the <code>method</code> attribute defines the method (either GET or POST) to use for delivering 
form data. In this example, we use the POST method (recommended).</li>
</ul>
<p>In line 3, we define a text input field with the help of the <code>&lt;input&gt;</code> element. The <code>name</code> attribute 
specifies the name of the field ("email"). The <code>type</code> attribute
specifies the purpose of the element (the type "text" means the input field is intended for
entering text). </p>
<p>In line 2, we have the <code>&lt;label&gt;</code> element which represents the label for the E-mail 
text input field (the corresponding input field's name is determined by the <code>for</code> 
attribute of the <code>&lt;label&gt;</code> element).</p>
<p>In lines 5-6, by analogy, we have the "Subject" input field and its label. </p>
<p>In line 9, we have the text area field which is suited well for entering
multi-line text. The height of the text area (6 rows) is defined by the <code>rows</code>
attribute. </p>
<p>In line 11, we have the submit button (input element with "submit" type). 
The <code>value</code> attribute allows you to set the title text for the button ("Submit").
By clicking this button, the user will send the form data to the server.</p>
<p>Line break <code>&lt;br&gt;</code> elements are used in lines 4, 7 and 10 to position
form controls one below another (otherwise they would be positioned in 
one line).</p>
<p>To see what this form looks like, you can put its HTML markup code in a <code>.html</code> file
and open the file in your browser. You will see the form visualization 
as in figure 7.4.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/typical_form.png">
<img src="images/forms/typical_form.png" alt="Figure 7.4. Visualization of the feedback form" /></a>
<span class="image-caption">Figure 7.4. Visualization of the feedback form</span>
</span>
</p>
<p>If you enter some data in the feedback form and click the <em>Submit</em> button, the web browser will
send an HTTP request to the URL you specified in the <code>action</code> attribute of the form.
The HTTP request will contain the data you entered.</p>
<h3 id="header-147">7.2.3. GET and POST Methods</h3>
<p>HTML forms support GET and POST methods for submitting the data to server. These
methods have important technical differences.</p>
<p>When using POST method (the default) for submitting the form, the data is 
sent in HTTP request body. For example, when you press the <em>Submit</em> button on the
feedback form, an HTTP request will look like the example below:</p>
<pre class="line-numbers"><code class="language-text">POST http://localhost/contactus HTTP/1.1
Host: localhost
Connection: keep-alive
Content-Length: 76
Accept: text/html,application/xhtml+xml,application/xml
Origin: null
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) 
Content-Type: application/x-www-form-urlencoded

email=name%40example.com&amp;subject=Example+Subject&amp;body=Hello%21&amp;submit=Submit
</code></pre>
<p>Above, you can see that the form data is transmitted in request body (line 10). Form fields
are concatenated in a single string and then URL-encoded to replace unsafe characters with allowed
characters from the ASCII table. </p>
<p>In comparison, when you set the GET method for the form, an HTTP request will look 
like the example below:</p>
<pre class="line-numbers"><code class="language-text">GET http://localhost/contactus?email=name%40example.com&amp;subject=Example+Subject&amp;body=Hello%21&amp;submit=Submit HTTP/1.1
Host: localhost
Connection: keep-alive
Accept: text/html,application/xhtml+xml,application/xml
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) 
Accept-Encoding: gzip,deflate,sdch

</code></pre>
<p>In the example above, you can see that the form data is concatenated, URL-encoded and sent 
as part of the HTTP request's URL (line 1), which makes the URL long and harder to read. 
Since the form data is sent inside the URL, this makes it easily visible to site visitors.</p>
<p>In most cases, you will use the POST method for delivering form data in the
request body, because the user doesn't need to see the data in the browser's 
navigation bar (especially when submitting passwords or other sensitive data). </p>
<blockquote class="notquote warning" data-type="warning"><p> Please note that submitting form data using the POST method does not protect your
 sensitive data (like passwords, credit card numbers, etc.) from being stolen. To
 protect such data, you'll have to direct your HTTP traffic to a <a href="http://en.wikipedia.org/wiki/Secure_Sockets_Layer">SSL</a> tunnel 
 (SSL stands for Secure Sockets Layer). Protected SSL connections are distinguished by
 using the <em>https://</em> schema in web page URLs. To enable SSL for your Apache HTTP
 server, you will need to obtain an SSL certificate from a trusted provider 
 (like <a href="http://www.verisign.com/">VeriSign</a>) and install it on your server.</p>
</blockquote><h2 id="header-148">7.3. Styling HTML Forms with Twitter Bootstrap</h2>
<p>In ZF3-based web sites, we use the Twitter Bootstrap CSS Framework that provides default 
CSS rules for styling forms and form fields. To apply the CSS rules to a form field
(like <code>&lt;input&gt;</code>, <code>&lt;textarea&gt;</code>, etc.), you should assign it the <code>.form-control</code> CSS class. Additionally,
when using labels together with input fields, put the label-input pairs inside of <code>&lt;div&gt;</code> elements
with the <code>.form-group</code> CSS class. For submit buttons, you can use the <code>.btn</code> CSS class plus a theme
class like <code>.btn-default</code>, <code>.btn-primary</code>, etc.</p>
<p>Below, we provide the modified example of the feedback form 
which uses the Bootstrap styling:</p>
<pre class=""><code class="language-html">&lt;h1&gt;Contact Us&lt;/h1&gt;

&lt;p&gt;
    Please fill out the following form to contact us. 
    We appreciate your feedback. 
&lt;/p&gt;

&lt;form name="contact-form" action="/contactus" method="post"&gt;        

  &lt;div class="form-group"&gt;
    &lt;label for="email"&gt;Your E-mail&lt;/label&gt;
    &lt;input name="email" type="text" class="form-control" 
           placeholder="name@example.com"&gt;
  &lt;/div&gt;
        
  &lt;div class="form-group"&gt;
    &lt;label for="subject"&gt;Subject&lt;/label&gt;            
    &lt;input name="subject" type="text" class="form-control" 
           placeholder="Type subject here"&gt;                              
  &lt;/div&gt;
        
  &lt;div class="form-group"&gt;
    &lt;label for="body"&gt;Message Body&lt;/label&gt;            
    &lt;textarea name="body" class="form-control" rows="6" 
              placeholder="Type message text here"&gt;&lt;/textarea&gt;
  &lt;/div&gt;
        
  &lt;input name="submit" type="submit"
         class="btn btn-primary" value="Submit"&gt;
&lt;/form&gt;
</code></pre>
<p>The visualization of the form is presented in figure 7.5.</p>
<p>Because Twitter Bootstrap is designed to support mobile phones, tablets, and
desktops, it makes the form fields as wide as the size of the screen. This may
make your form too wide and hard to understand. To limit form width,
you can use the Bootstrap-provided grid, like in the example below:</p>
<pre class=""><code class="language-html">&lt;div class="row"&gt;
  &lt;div class="col-md-6"&gt;
    &lt;form&gt;
      ...		
    &lt;/form&gt;
  &lt;/div&gt;    
&lt;/div&gt;
</code></pre>
<p>In the HTML markup above, we put a form inside of the 6-column-width grid cell,
which makes the form half the width of the screen.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/styled_contact_form.png">
<img src="images/forms/styled_contact_form.png" alt="Figure 7.5. Styled feedback form" /></a>
<span class="image-caption">Figure 7.5. Styled feedback form</span>
</span>
</p>
<h2 id="header-149">7.4. Retrieving Form Data in a Controller's Action</h2>
<p>The site user typically works with the form in the following order:</p>
<ul>
<li>First, a controller's action is executed rendering the web page 
containing the form prompting the site user for input.
Once the user fills the form fields, they click the <em>Submit</em> button,
and this generates an HTTP request and sends the data to the server. </li>
<li>Second, in your controller's action method, you can 
extract the submitted data from POST (and/or GET) variables,
and display the page with the results of the form processing.</li>
</ul>
<p>Typically these two web pages are handled by <em>the same</em> controller action. </p>
<p>In the following example, we will show how you can create a controller action 
for displaying the feedback form and retrieving the data submitted by the user. 
To start, add the <em>contact-us.phtml</em> view template in the <em>application/index/</em> directory under 
the module's <em>view/</em> directory (see figure 7.6 for example).</p>
<p>Put the HTML markup code of the feedback form from the previous section into the view
template file.</p>
<p>Then, add the <code>contactUsAction()</code> action method to the <code>IndexController</code> class. In the action method, we 
want to extract raw data from the feedback form submitted by the site user:</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/contactus_file.png">
<img src="images/forms/contactus_file.png" alt="Figure 7.6. Creating the contact-us.phtml file" /></a>
<span class="image-caption">Figure 7.6. Creating the contact-us.phtml file</span>
</span>
</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Controller;

// ...

class IndexController extends AbstractActionController 
{
  // This action displays the feedback form
  public function contactUsAction() 
  {
    // Check if user has submitted the form
    if($this-&gt;getRequest()-&gt;isPost()) {
      
	  // Retrieve form data from POST variables
	  $data = $this-&gt;params()-&gt;fromPost();     
	  
	  // ... Do something with the data ...
	  var_dump($data);	  
    } 
        
    // Pass form variable to view
    return new ViewModel([
          'form' =&gt; $form
       ]);
  }
}
</code></pre>
<p>In the code above, we define the <code>contactUsAction()</code> action method in the 
<code>IndexController</code> class (line 9). </p>
<p>Then, in line 12, we check whether the request is a POST request (checking 
the starting line of the HTTP request). Typically, the form uses the POST method
for submitting the data. For this reason, we can detect if the form is submitted or not
by checking the starting line of the HTTP request.</p>
<p>In line 15 we retrieve the raw data submitted by the user. We extract all the POST variables
with the help of the <code>Params</code> controller plugin. The data is returned in the form of an array and
saved into the <code>$data</code> variable. </p>
<p>Finally, we have to add a literal route to make a short and memorable URL
for the <em>Contact Us</em> page. Add the following <code>contactus</code> key to the routing configuration in the 
<em>module.config.php</em> file:</p>
<pre class=""><code class="language-php">&lt;?php
return [
  // ...
  'router' =&gt; [
    'routes' =&gt; [
      // Add the following routing rule for the "Contact Us" page 
      'contactus' =&gt; [
        'type' =&gt; Literal::class,
          'options' =&gt; [
             'route'    =&gt; '/contactus',
             'defaults' =&gt; [
               'controller' =&gt; Controller\IndexController::class,
               'action'     =&gt; 'contactUs',
             ],
           ],
         ],
       ],		 
    ],
  ],  
  // ...
];

</code></pre>
<p>Now, if you type the "http://localhost/contactus" URL in your web browser's navigation bar,
you should see the page as in figure 7.7. Enter an E-mail, subject, and body text and
click the <em>Submit</em> button on the form. The data will be sent to the server, and finally extracted
in the <code>IndexController::contactUsAction()</code> method.</p>
<p>Below, an example of the <code>$data</code> array (produced with the <code>var_dump()</code> 
PHP function) is shown. As you can see, the array contains a key for each form field, 
including the "submit" field.</p>
<pre class=""><code class="language-php">array (size=4)
    'email' =&gt; string 'name@example.com' (length=16)
    'subject' =&gt; string 'Happy New Year!' (length=15)
    'body' =&gt; string 'Dear Support, I'd like to thank you for the 
              excellent quality of your support service and wish you 
              a Happy New Year!' (length=118)
    'submit' =&gt; string 'Submit' (length=6)
</code></pre>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/feedback_form.png">
<img src="images/forms/feedback_form.png" alt="Figure 7.7. Feedback Form" /></a>
<span class="image-caption">Figure 7.7. Feedback Form</span>
</span>
</p>
<h2 id="header-150">7.5. Forms and Model-View-Controller</h2>
<p>In the previous section, we've considered a very simple form usage case: we prepared the
view template with form HTML markup and a controller action responsible for displaying the
form and dumping raw user input to the screen. However, using raw user input in real-life
applications has a disadvantage in that we do not check user-submitted data
for possible errors and/or malicious code. Here we will discuss how to perform such validation.</p>
<p>In a ZF3-based web site that uses the Model-View-Controller pattern, form functionality 
is usually separated into <em>form models</em> responsible for field definition, filtering and 
validation; and <em>form presentation</em> (view) which is typically implemented with the help 
of special view helpers.</p>
<p>The functionality allowing to create form models, add validation rules and
use view helpers, is schematically shown in figure 7.8. As you can see from the figure, the 
standard HTML forms functionality is used as a base. </p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/html_zf2_forms.png">
<img src="images/forms/html_zf2_forms.png" alt="Figure 7.8. Form Functionality in ZF3" /></a>
<span class="image-caption">Figure 7.8. Form Functionality in ZF3</span>
</span>
</p>
<p>The MVC approach to working with forms has the following advantages:</p>
<ul>
<li>You are able to reuse your form model in different controller's actions.</li>
<li>By using the view helpers, you can (partly) avoid the boring work of preparing HTML markup
for rendering the form and its possible validation errors.</li>
<li>You are able to create one or several visual representations for the same form model.</li>
<li>By encapsulating the form validation logic in a single form model class you
have fewer places in your code where you need to check user input, thus you 
improve your site security.</li>
</ul>
<h3 id="header-151">7.5.1. A Typical Form Usage Workflow</h3>
<p>Generally speaking, you instantiate a form model inside of your controller's 
action method, then you retrieve the user-submitted data from PHP variables, 
and pass it to the form model for validation. 
Form view helpers are used in a view template for generating HTML markup of 
the form. This typical workflow is illustrated by figure 7.8.</p>
<p>Arrows in figure 7.8 denote the direction of the actions:</p>
<ol>
<li><p>First, inside of the controller's action method, you retrieve the 
data submitted by the site user from GET, POST (and possibly other) PHP 
variables. Then you create an instance of the form model and pass it 
the user-submitted data. The form model's work is to check (validate) the
data for correctness, and if something is wrong, produce error message(s) 
for any invalid form field.   </p>
</li>
<li><p>Secondly, you pass the form model to the <code>.phtml</code> view template for 
rendering (with the help of the <code>ViewModel</code> variable container). The 
view template then will be able to access the form model and call its 
methods.   </p>
</li>
<li><p>And finally, the view template uses the form model and the view helpers 
provided by Zend Framework 3 to render the form fields (and to display 
possible validation error messages produced at the validation stage). 
As a result, the HTML markup of the form is produced.</p>
</li>
</ol>
<p>In the following sections, we will discuss these in more detail.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/forms_and_mvc.png">
<img src="images/forms/forms_and_mvc.png" alt="Figure 7.8. Working with form in an MVC application" /></a>
<span class="image-caption">Figure 7.8. Working with form in an MVC application</span>
</span>
</p>
<h2 id="header-152">7.6. A Form Model</h2>
<p>A form model is usually a PHP class which creates a number of <em>fields</em>. 
The base class for all form models is the <code>Form</code> class defined in the <code>Zend\Form</code> 
component.</p>
<p>Fields in a form model can optionally be grouped into <em>fieldsets</em>. Moreover, the form model
itself can be considered as a fieldset. This fact is reflected in form class inheritance 
(figure 7.9). As you can see from the figure, the <code>Form</code> class extends the <code>Fieldset</code> class.
The <code>Fieldset</code> class, in turn, is derived from the <code>Element</code> class which represents a single
form field and its attributes. </p>
<blockquote class="notquote tip" data-type="tip"><p> This class inheritance may look strange at first sight, but everything becomes logical
 if you remember that the <code>Form</code> class inherits methods for adding form fields from the <code>Fieldset</code>
 class, and that it inherits methods for setting form attributes from the <code>Element</code> class.</p>
</blockquote><p>Below, we provide a stub model class for the feedback form from our previous examples:</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/form_inheritance.png">
<img src="images/forms/form_inheritance.png" alt="Figure 7.9. Form class inheritance" /></a>
<span class="image-caption">Figure 7.9. Form class inheritance</span>
</span>
</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Form;

use Zend\Form\Form;

// A feedback form model
class ContactForm extends Form
{
  // Constructor.   
  public function __construct()
  {
    // Define form name
    parent::__construct('contact-form');

    // Set POST method for this form
    $this-&gt;setAttribute('method', 'post');
  
    // (Optionally) set action for this form
    $this-&gt;setAttribute('action', '/contactus');
  
    // Create the form fields here ...	
  }
}
</code></pre>
<p>As you can see, form models of the web site's <code>Application</code> module 
(by convention) belong to <code>Application\Form</code> namespace (line 2).</p>
<p>In line 7, we define the <code>ContactForm</code> form model class which extends the <code>Form</code> base class.</p>
<p>In line 10, we define the constructor method for the class. Because we derive our form
model from the base <code>Form</code> class, we have to call the parent class' constructor to initialize
it (line 13). The parent class' constructor accepts an optional argument allowing it to set the form's name
('contact-form').</p>
<p>We can also set form data delivery method (POST) by using the <code>setAttribute()</code> 
method provided by the base class (line 16). The <code>setAttribute()</code> takes two parameters:
the first one is the name of the attribute to set, and the second one is the value of the
attribute.</p>
<p>You also can set the form's "action" attribute (line 19) with the <code>setAttribute()</code> method, analogous to the way 
you did with the "name" attribute. Actually, as you will see later, setting the form's "action" attribute is optional.</p>
<blockquote class="notquote information" data-type="information"><p> Setting the "action" attribute for the form is optional, because empty 
 form action forces the browser to submit form data to the URL of the 
 current page. This is sufficient in most scenarios, because usually 
 you use the single controller action for both displaying the form
 and processing its data.</p>
</blockquote><p>Form fields are typically created inside of the form model's constructor 
(look at line 21). In the next section, we will learn which form fields 
are available and how to add them to the form model.</p>
<h2 id="header-153">7.7. Form Elements</h2>
<p>In a form model, an input field is typically paired with the text label (<code>&lt;label&gt;</code> and <code>&lt;input&gt;</code> tags are 
used together). Such a pair is also called a form model's <em>element</em>.</p>
<p>Analogous to an HTML form field, a form model's element may contain the name and other (optional) 
attributes (e.g. "id", "class", etc.) Additionally, you may set <em>options</em> to an element;
the options mostly allow you to specify the text and attributes for the element's label.</p>
<p>All form model's elements are inherited from the base class <code>Element</code> which also belongs
to the <code>Zend\Form</code> component. The <code>Element</code> base class implements the <code>ElementInterface</code> interface. 
The class inheritance diagram is shown in figure 7.10.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/form_element_inheritance.png">
<img src="images/forms/form_element_inheritance.png" alt="Figure 7.10. Form element class inheritance" /></a>
<span class="image-caption">Figure 7.10. Form element class inheritance</span>
</span>
</p>
<p>Concrete form element classes extend the <code>Element</code> base class. They are listed in table 7.3. 
These classes live in the <code>Zend\Form\Element</code> namespace.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.3. Form elements compatible with HTML 4</div><table>
<thead>
<tr>
<th> <em>Class name</em>                   </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Button</code>                       </td>
<td>  Button.                                                       </td>
</tr>
<tr>
<td> <code>Checkbox</code>                     </td>
<td> Check box.                                                    </td>
</tr>
<tr>
<td> <code>File</code>                         </td>
<td> File field.                                                   </td>
</tr>
<tr>
<td> <code>Hidden</code>                       </td>
<td> Hidden field.                                                 </td>
</tr>
<tr>
<td> <code>Image</code>                        </td>
<td> Image field.                                                  </td>
</tr>
<tr>
<td> <code>Password</code>                     </td>
<td> Password field.                                               </td>
</tr>
<tr>
<td> <code>Radio</code>                        </td>
<td> Radio button.                                                 </td>
</tr>
<tr>
<td> <code>Select</code>                       </td>
<td> Dropdown list.                                                </td>
</tr>
<tr>
<td> <code>Submit</code>                       </td>
<td> Submit button.                                                </td>
</tr>
<tr>
<td> <code>Text</code>                         </td>
<td> General-purpose text input field.                             </td>
</tr>
<tr>
<td> <code>Textarea</code>                     </td>
<td> Multi-line text area.                                         </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.3. Form elements compatible with HTML 5</div><table>
<thead>
<tr>
<th> <em>Class name</em>                   </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Color</code>                        </td>
<td>  Color picker.                                                 </td>
</tr>
<tr>
<td> <code>Date</code>                         </td>
<td> Date picker.                                                  </td>
</tr>
<tr>
<td> <code>DateTime</code>                     </td>
<td> Date &amp; time (with time zone).                                 </td>
</tr>
<tr>
<td> <code>DateTimeLocal</code>                </td>
<td> Date &amp; time (without time zone).                              </td>
</tr>
<tr>
<td> <code>Email</code>                        </td>
<td> E-mail field.                                                 </td>
</tr>
<tr>
<td> <code>Month</code>                        </td>
<td> Month input field.                                            </td>
</tr>
<tr>
<td> <code>Number</code>                       </td>
<td> A text input field accepting numbers.                         </td>
</tr>
<tr>
<td> <code>Time</code>                         </td>
<td> Text input field for entering time.                           </td>
</tr>
<tr>
<td> <code>Url</code>                          </td>
<td> Text input field for entering an URL.                         </td>
</tr>
<tr>
<td> <code>Week</code>                         </td>
<td> Text input field for entering days of week.                   </td>
</tr>
<tr>
<td> <code>Range</code>                        </td>
<td> Range field (slider).                                         </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.3. Compound fields</div><table>
<thead>
<tr>
<th> <em>Class name</em>                   </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>MultiCheckbox</code>                </td>
<td>  A group of related check boxes.                               </td>
</tr>
<tr>
<td> <code>DateTimeSelect</code>               </td>
<td> Date &amp; time select.                                           </td>
</tr>
<tr>
<td> <code>DateSelect</code>                   </td>
<td> Date select.                                                  </td>
</tr>
<tr>
<td> <code>MonthSelect</code>                  </td>
<td> Month select.                                                 </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.3. Security Form Elements</div><table>
<thead>
<tr>
<th> <em>Class name</em>                   </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Captcha</code>                        <code>Csrf</code>                         </td>
<td>  Human check image.                                              Cross-site request forgery prevention.                        </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.3. Other Form Elements</div><table>
<thead>
<tr>
<th> <em>Class name</em>                   </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Collection</code>                   </td>
<td>  Element collection.                                           </td>
</tr>
</tbody>
</table>
</div>
<p>In the table above, you can see that the ZF3-provided form elements have direct mapping on HTML4 
and HTML5 input fields (discussed in the beginning of this chapter). </p>
<p>For your convenience, ZF3 also provides several "compound" fields. The
<code>MultiCheckbox</code> field is a field which is composed of a group of typical checkboxes related to
each other. The <code>DateTimeSelect</code>, <code>DateSelect</code>, and <code>MonthSelect</code> elements are analogous to corresponding
HTML5 elements, but simulate them with the usual select fields. These input fields have an advantage in that they
are supported by all web browsers, unlike the corresponding HTML5 fields. The visual representation of 
these elements can be seen in figure 7.11.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/compound_form_fields.png">
<img src="images/forms/compound_form_fields.png" alt="Figure 7.11. Compound form fields" /></a>
<span class="image-caption">Figure 7.11. Compound form fields</span>
</span>
</p>
<p>Additionally, ZF3 provides "security" form fields <code>Captcha</code> and <code>Csrf</code> which
can be used on a form for enhancing the security. The <code>Captcha</code> element is a graphical element (image)
that is placed on a form for checking if the site user is a human or a robot. The <code>Csrf</code> element has
no visual representation and is used for 
prevention of hacker attacks related to cross-site request forgery <sup id="fnref:csrf"><a href="#fn:csrf" class="footnote-ref" rel="footnote">18</a></sup>. </p>
<footnotes id="fn:csrf"><p><sup>18)</sup> Cross-site request forgery (CSRF) is a type of malicious exploit of 
a website whereby unauthorized commands are transmitted from a user 
that the website trusts.</p>
</footnotes>
<p>There is another special form element called <code>Collection</code>. This element is analogous to fieldset,
because it allows you to group related form elements. But, it is designed for adding form elements dynamically by binding
an array of objects to the form. </p>
<h3 id="header-154">7.7.1. Adding Elements to a Form Model</h3>
<p>The methods inherited by the <code>Form</code> base class from the <code>Fieldset</code> class are used to 
add elements (and fieldsets) to the form model. These methods are summarized in the table 7.4.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.4. Methods provided by the Fieldset class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>add($elementOrFieldset, $flags)</code></td>
<td>  Attaches an element (or fieldset).                            </td>
</tr>
<tr>
<td> <code>has($elementOrFieldset)</code>        </td>
<td> Checks whether certain element is attached.                   </td>
</tr>
<tr>
<td> <code>get($elementOrFieldset)</code>        </td>
<td> Retrieves the given element (or fieldset) by name.            </td>
</tr>
<tr>
<td> <code>getElements()</code>                  </td>
<td> Retrieves all attached elements.                              </td>
</tr>
<tr>
<td> <code>getFieldsets()</code>                 </td>
<td> Retrieves all attached fieldsets.                             </td>
</tr>
<tr>
<td> <code>count()</code>                        </td>
<td> Return the count of attached elements/fieldsets.              </td>
</tr>
<tr>
<td> <code>remove($elementOrFieldset)</code>     </td>
<td> Removes the element (or fieldset).                            </td>
</tr>
</tbody>
</table>
</div>
<p>Particularly, we are interested in the <code>add()</code> method which is used to attach
an element to a form. The <code>add()</code> method takes two arguments: the first one (named <code>$elementOrFieldset</code>)
is an element to insert, and the second one (named <code>$flags</code>) is the optional flags. </p>
<p>The <code>$elementOrFieldset</code> parameter may either be an instance of an 
<code>Element</code>-derived class (or the <code>Fieldset</code> class), or an array describing the element that 
should be created. </p>
<p>The optional <code>$flags</code> argument is an array which may contain a combination of the following keys: <code>name</code> 
(allows you to set the element's name) and <code>priority</code> (allows to specify the zero-based 
index in the list of elements to insert the element to. If the priority flag is not 
specified, the element will be inserted at the end of the list of the form model's elements.</p>
<p>Below, we provide two code examples illustrating the possible ways of adding
elements to a form. </p>
<h3 id="header-155">7.7.2. Method 1: Passing an Instance of an Element</h3>
<p>The following code fragment creates an instance of the <code>Zend\Form\Element\Text</code> class
and adds the element to the form model:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Form;

// Define an alias for the class name
use Zend\Form\Form;
use Zend\Form\Element\Text;

// A feedback form model
class ContactForm extends Form
{
  // Constructor.   
  public function __construct()
  {
    // Create the form fields here ...	
    $element = new Text(
                'subject',            // Name of the element
                [                     // Array of options
                 'label'=&gt; 'Subject'  // Text label
                ]);
    $element-&gt;setAttribute('id', 'subject');

    // Add the "subject" field to the form
    $this-&gt;add($element);
  }
}
</code></pre>
<p>In the code above, we've created an instance of the <code>Zend\Form\Element\Text</code> class (line 15). The
class constructor takes two parameters: the element's name ("subject") and an array of options 
(here we specify the text label "Subject").</p>
<p>Additionally, you may configure the element using the methods provided by the <code>Element</code> base class.
For example, in line 20, we set the "id" attribute with the <code>setAttribute()</code> method. For your reference, 
the (most important) methods of the <code>Element</code> base class which can be used for
configuring a form element are presented in table 7.5.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.5. Methods provided by the Element class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>setName($name)</code>                 </td>
<td>  Sets element's name.                                          </td>
</tr>
<tr>
<td> <code>getName()</code>                      </td>
<td> Retrieves element's name.                                     </td>
</tr>
<tr>
<td> <code>setOptions($options)</code>           </td>
<td> Sets options.                                                 </td>
</tr>
<tr>
<td> <code>getOptions($options)</code>           </td>
<td> Retrieves options.                                            </td>
</tr>
<tr>
<td> <code>getOption($option)</code>             </td>
<td> Retrieves the given option.                                   </td>
</tr>
<tr>
<td> <code>setAttribute($key, $value)</code>     </td>
<td> Sets a single element attribute.                               </td>
</tr>
<tr>
<td> <code>getAttribute($key)</code>             </td>
<td> Retrieves a single element attribute.                          </td>
</tr>
<tr>
<td> <code>removeAttribute($key)</code>          </td>
<td> Removes an attribute.                                         </td>
</tr>
<tr>
<td> <code>hasAttribute($key)</code>             </td>
<td> Checks whether such an attribute presents.                    </td>
</tr>
<tr>
<td> <code>setAttributes($arrayOrTraversable)</code></td>
<td> Removes an attribute.                                      </td>
</tr>
<tr>
<td> <code>getAttributes()</code>                </td>
<td> Retrieves all attributes at once.                              </td>
</tr>
<tr>
<td> <code>clearAttributes()</code>              </td>
<td> Removes all attributes at once.                               </td>
</tr>
<tr>
<td> <code>setValue()</code>                     </td>
<td> Sets the element value.                                         </td>
</tr>
<tr>
<td> <code>getValue()</code>                     </td>
<td> Retrieves the element value.                                    </td>
</tr>
<tr>
<td> <code>setLabel()</code>                     </td>
<td> Sets the label used for this element.                           </td>
</tr>
<tr>
<td> <code>getLabel()</code>                     </td>
<td> Retrieves the label string used for this element.              </td>
</tr>
<tr>
<td> <code>setLabelAttributes()</code>           </td>
<td> Sets the attributes to use with the label.                     </td>
</tr>
<tr>
<td> <code>getLabelAttributes()</code>           </td>
<td> Gets the attributes to use with the label.                    </td>
</tr>
<tr>
<td> <code>setLabelOptions()</code>              </td>
<td> Sets label specific options.                                  </td>
</tr>
<tr>
<td> <code>getLabelOptions()</code>              </td>
<td> Retrieves label specific options.                             </td>
</tr>
</tbody>
</table>
</div>
<h3 id="header-156">7.7.3. Method 2: Using Array Specification</h3>
<p>The second example below (equivalent to the first one) shows how to use an 
array specification to add an element to form. This method is preferable, because
it requires less code to write.</p>
<blockquote class="notquote information" data-type="information"><p> When using array specification for adding an element to a form, the element will 
 be instantiated and configured automatically. Internally, this is accomplished with the 
 help of the <code>Zend\Form\Factory</code> factory class (illustrated by figure 7.12).</p>
</blockquote><pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Form;

// Define an alias for the class name
use Zend\Form\Form;

// A feedback form model
class ContactForm extends Form
{
  // Constructor.   
  public function __construct()
  {
    // Add "subject" field
    $this-&gt;add([
      'type'  =&gt; 'text',        // Element type
      'name' =&gt; 'subject',      // Field name
      'attributes' =&gt; [         // Array of attributes
        'id'  =&gt; 'subject',     
      ],
      'options' =&gt; [            // Array of options
         'label' =&gt; 'Subject',  // Text label
      ],
    ]);    
  }
}
</code></pre>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/factory_graph.png">
<img src="images/forms/factory_graph.png" alt="Figure 7.12. The logic of the add() method" /></a>
<span class="image-caption">Figure 7.12. The logic of the add() method</span>
</span>
</p>
<p>In line 14 above, we call the form model's <code>add()</code> method to add the element to form.
We pass the element specification to the <code>add()</code> method in the form of an array. The array 
has the following typical keys:</p>
<ul>
<li><p>the <code>type</code> key (line 15) defines the class name to use for instantiation of the element. Here you
can use either the full class name (e.g. <code>Zend\Form\Element\Text</code>) or its short alias <sup id="fnref:alias"><a href="#fn:alias" class="footnote-ref" rel="footnote">19</a></sup> (e.g. "text").</p>
</li>
<li><p>the <code>name</code> key (line 16) defines the name for the field ("subject").</p>
</li>
<li><p>the <code>attributes</code> key (line 17) defines the list of HTML attributes to set (here we set the "id" attribute).</p>
</li>
<li><p>the <code>options</code> array (line 18) allows you to specify the text label for the element.</p>
</li>
</ul>
<footnotes id="fn:alias"><p><sup>19)</sup> If you are confused where we take element aliases from, than you should
know that they are defined inside of the <code>Zend\Form\FormElementManager</code> class.</p>
</footnotes>
<h2 id="header-157">7.8. Example: Creating the Contact Form Model</h2>
<p>Now that we know how to set the form name, action, and method attributes and how to add 
fields (elements) to the form, let's create the complete model class for the feedback form that 
we used in our previous examples. </p>
<p>As we know, form model classes for the <code>Application</code> module live 
inside the <code>Application\Form</code> namespace. So, we have to create the 
<em>ContactForm.php</em> file inside of the <em>Form</em> directory under the 
<em>Application</em> module's source directory (figure 7.13). </p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/form_dir.png">
<img src="images/forms/form_dir.png" alt="Figure 7.13. Form directory" /></a>
<span class="image-caption">Figure 7.13. Form directory</span>
</span>
</p>
<p>We will have two methods in our form class: </p>
<ul>
<li><code>__construct()</code> constructor will define the form name and method (POST), and 
initialize the form by adding its elements;</li>
<li><code>addElements()</code> protected method will contain the actual code for 
adding form elements and will be called by the constructor. </li>
</ul>
<blockquote class="notquote information" data-type="information"><p> We put the field creation logic into the <code>addElements()</code> protected 
 method to better structure the form model's code.</p>
</blockquote><p>The code of the <code>ContactForm</code> class is presented below:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Form;

use Zend\Form\Form;

/**
 * This form is used to collect user feedback data like user E-mail, 
 * message subject and text.
 */
class ContactForm extends Form
{
  // Constructor.   
  public function __construct()
  {
    // Define form name
    parent::__construct('contact-form');

    // Set POST method for this form
    $this-&gt;setAttribute('method', 'post');
        	
    // Add form elements
    $this-&gt;addElements();    
  }
    
  // This method adds elements to form (input fields and 
  // submit button).
  private function addElements() 
  {
    // Add "email" field
    $this-&gt;add([
	        'type'  =&gt; 'text',
            'name' =&gt; 'email',
            'attributes' =&gt; [                
                'id' =&gt; 'body'
            ],
            'options' =&gt; [
                'label' =&gt; 'Your E-mail',
            ],
        ]);
        
    // Add "subject" field
    $this-&gt;add([
            'type'  =&gt; 'text',
            'name' =&gt; 'subject',
            'attributes' =&gt; [
              'id' =&gt; 'subject'  
            ],
            'options' =&gt; [
                'label' =&gt; 'Subject',
            ],
        ]);
        
    // Add "body" field
    $this-&gt;add([
            'type'  =&gt; 'text',
            'name' =&gt; 'body',			
            'attributes' =&gt; [                
			  'id' =&gt; 'body'
            ],
            'options' =&gt; [
                'label' =&gt; 'Message Body',
            ],
        ]);
        
    // Add the submit button
    $this-&gt;add([
            'type'  =&gt; 'submit',
            'name' =&gt; 'submit',
            'attributes' =&gt; [                
                'value' =&gt; 'Submit',
            ],
        ]);
    }        
}
</code></pre>
<p>In line 10 above, we define the <code>ContactForm</code> class which extends the
<code>Form</code> base class.</p>
<p>In lines 13-23, we have the constructor method. It calls the base class'
constructor (line 16) and passes the form name as its argument ("contact-form").
In line 19, the base class' <code>setAttribute()</code> method is called allowing you to set the method 
name for the form (we set the POST method). </p>
<p>In line 22, the <code>addElements()</code> protected method is called, which does the actual work of 
adding elements to the form. The code of the <code>addElements()</code> is located in lines 27-70.
To add elements to the form, we call the <code>add()</code> method provided by the base class.
This method accepts the single argument -- an array containing configuration for an
element. We add four fields: the <code>email</code>, the <code>subject</code>, the <code>body</code> and the <code>submit</code> field.</p>
<p>In figure 7.14, you can see schematic graphical representation of the form model
we have created.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/form_model.png">
<img src="images/forms/form_model.png" alt="Figure 7.14. The feedback form model and its elements" /></a>
<span class="image-caption">Figure 7.14. The feedback form model and its elements</span>
</span>
</p>
<h2 id="header-158">7.9. Adding Form Validation Rules</h2>
<p>Form validation is the procedure of filtering and checking the data passed to the server 
during the form submission. For example, for our feedback form, we want to perform 
the following checks:</p>
<ul>
<li>We want to test that the E-mail address, message subject, and body fields are always
present (because these fields are <em>required</em>).</li>
<li>We want to ensure that the user entered a valid E-mail address like <em>name@example.com</em>.</li>
<li>Users may add white space characters to the beginning and/or the end of the E-mail
address, so we would like to filter such characters out (perform the string trimming
operation). </li>
<li>It would be useful to check for minimum and maximum allowed length of the message subject and
body text. </li>
<li>For the message subject, we would like to filter out (strip) the new line characters and HTML tags <sup id="fnref:html"><a href="#fn:html" class="footnote-ref" rel="footnote">20</a></sup>. </li>
<li>We also want to strip HTML tags from the message body.</li>
</ul>
<footnotes id="fn:html"><p><sup>20)</sup> There may be malicious users inserting HTML code in the message. If you open
such code in your browser, you may see some undesired content. To avoid
this, we need to replace HTML tags in message subject and text.</p>
</footnotes>
<p>The requirements above are called <em>validation rules</em>. Validation rules can be
divided into two categories: filters and validators. </p>
<p>The <em>filters</em> transform the user-entered data to fix possible errors 
or to ensure the data conforms to a certain format. Filters are typically applied first, 
validators are applied in the last turn. </p>
<p><em>Validators</em> check whether the data is acceptable or not. If all data is correct,
the form is considered valid and the data can be safely used by the business logic layer. 
If a certain field is invalid, a validator raises an error flag. In that case, the form is 
typically shown to the user again, and the user is asked to correct any input errors and resend 
the form to server. </p>
<blockquote class="notquote question" data-type="question"><p> <strong>What happens if I don't add a validation rule for a certain form field?</strong></p>
<p> If you do not add a validation rule then the user-submitted field value
 will not be checked, leaving a hole in your site's security. It is recommended
 to always add a validation rule per each form field entered by user and add as many 
 checks per each field as needed to keep your form secure.</p>
</blockquote><h3 id="header-159">7.9.1. Input Filter</h3>
<p>In ZF3, you store the validation rules with the help of the <code>InputFilter</code> class.
The <code>InputFilter</code> class is defined in the <code>Zend\InputFilter</code> component. 
The input filter is a container for so called <em>inputs</em>. Typically, you add an input
per each form model's field you have.</p>
<blockquote class="notquote information" data-type="information"><p> An input may consist of filters and/or validators and some additional information.
 For example, an input may contain the flag telling if the field is required or if its value may
 be missing from HTTP request. </p>
</blockquote><p>Analogous to adding a form model's fields, there are two possible ways of adding
inputs to the input filter container: either via passing an instance of an input
class as the argument of its <code>add()</code> method, or via passing the array specification <sup id="fnref:inputfactory"><a href="#fn:inputfactory" class="footnote-ref" rel="footnote">21</a></sup>.
In the next section, we will describe the latter method (it is preferable, 
because it requires less code to write).</p>
<footnotes id="fn:inputfactory"><p><sup>21)</sup> In the latter (array specification) case, the input will be 
automatically created with the help of the <code>Zend\InputFilter\Factory</code> class.</p>
</footnotes>
<h3 id="header-160">7.9.2. Adding Inputs to Input Filter</h3>
<p>To add an input to the input filter, you use its <code>add()</code> method, which takes the single
argument - an array specification of the input in the following form:</p>
<pre class="line-numbers"><code class="language-php">[
  'name'     =&gt; '&lt;name&gt;',
  'type'     =&gt; '&lt;type&gt;',
  'required' =&gt; &lt;required&gt;,
  'filters'  =&gt; [
     // Add filters configuration here ...
  ],                
  'validators' =&gt; [
     // Add validators configuration here ...
  ]
]
</code></pre>
<p>In the above array, we have the following keys:</p>
<ul>
<li><p>The <code>name</code> key (line 2) defines the name of the input. The name should be
the same as the name of the form model's field. If the name of the input doesn't 
match the name of the corresponding form model's field, the validation rule
won't be applied to the field.</p>
</li>
<li><p>The <code>type</code> key (line 3) defines the class name of the input. This key is optional.
By default (when this key is omitted), the <code>Zend\InputFilter\Input</code> class is used. 
Available input classes are shown in figure 7.15. In figure 7.15, the <code>Input</code> class 
is designed to be used with regular scalar values, <code>ArrayInput</code> is used
for filtering/validating array values, and <code>FileInput</code> is used for checking uploaded files.  </p>
</li>
<li><p>The <code>required</code> key (line 4) tells whether the form field is required or optional. If the
field is required, the site user will have to fill it in; otherwise he will
receive a validation error.</p>
</li>
<li><p>the <code>filters</code> (line 5) and <code>validators</code> (line 8) keys may contain the configuration for zero,
one, or several filters and/or validators applied to the form model's field. </p>
</li>
</ul>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/input_inheritance.png">
<img src="images/forms/input_inheritance.png" alt="Figure 7.15. Input class inheritance" /></a>
<span class="image-caption">Figure 7.15. Input class inheritance</span>
</span>
</p>
<h4 id="header-161">7.9.2.1. Filter Configuration</h4>
<p>A typical filter configuration is presented below:  </p>
<pre class="line-numbers"><code class="language-php">[
  'name' =&gt; '&lt;filter_name&gt;',  
  'priority' =&gt; &lt;priority&gt;
  'options' =&gt; [
    // Filter options go here ...
  ]
],                    
</code></pre>
<p>The <code>name</code> key (line 2) is the name for the filter. This may be either
a full filter class name (e.g. <code>Zend\Filter\StringTrim</code> or an alias (e.g. <code>StringTrim</code>).</p>
<p>The optional <code>priority</code> key (line 3) defines filter priority in the list of filters. The priority
must be an integer number. The filters with the highest priority will be applied first. By default, 
the <code>FilterChain::DEFAULT_PRIORITY</code> constant (value 1000) is assigned.</p>
<p>The <code>options</code> array (line 4) is specific to a certain filter and may contain
parameters for configuring the filter.</p>
<h4 id="header-162">7.9.2.2. Validator Configuration</h4>
<p>A typical validator configuration is presented below:</p>
<pre class="line-numbers"><code class="language-php">[
  'name' =&gt; '&lt;validator_name&gt;',
  'break_chain_on_failure' =&gt; &lt;flag&gt;
  'options' =&gt; [
    // Validator options go here ...
  ]
],                    
</code></pre>
<p>The <code>name</code> key (line 2) is the name for the validator. This may be either
a full validator class name (e.g. <code>Zend\Validator\EmailAddress</code> or an alias 
(e.g. <code>EmailAddress</code>).  </p>
<p>The <code>break_chain_on_failure</code> optional key (line 3) defines the behavior in 
case the validator check fails. If this equals to <code>true</code>, subsequent validators
in the list will not be executed; otherwise every validator in the list will be executed
without depending on the result of other validators.</p>
<p>The <code>options</code> array (line 4) is specific to certain validator class and may contain
parameters for configuring the validator.</p>
<h4 id="header-163">7.9.2.3. Attaching Input Filter to Form Model</h4>
<p>Once you have created and populated the input filter container, you
have to attach it to the form model. The <code>Form</code> base class provides
the <code>setInputFilter()</code> method intended for this purpose (see table 7.6).</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.6. Methods provided by the Form base class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>setInputFilter($inputFilter)</code> </td>
<td>  Attaches the input filter container to the form.              </td>
</tr>
<tr>
<td> <code>getInputFilter()</code>             </td>
<td> Retrieves the input filter attached to the form.              </td>
</tr>
</tbody>
</table>
</div>
<h3 id="header-164">7.9.3. Creating Input Filter for the Contact Form</h3>
<p>Now that you have a general idea on know how to define the input filter container 
and populate it with filters and validators for each form field, let's complete
our <code>ContactForm</code> form model class. Below, we add the <code>addInputFilter()</code> 
private method, which defines the filtering/validation rules, stores them in input filter container,
and attaches the input filter to the form model:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// ...
use Zend\InputFilter\InputFilter;

class ContactForm extends Form
{
  public function __construct()
  {
    // ... call this method to add validation rules
    $this-&gt;addInputFilter();
  }
    
  // ...
    
  // This method creates input filter (used for form filtering/validation).
  private function addInputFilter() 
  {
    $inputFilter = new InputFilter();        
    $this-&gt;setInputFilter($inputFilter);
        
    $inputFilter-&gt;add([
        'name'     =&gt; 'email',
        'required' =&gt; true,
        'filters'  =&gt; [
           array('name' =&gt; 'StringTrim'),                    
        ],                
        'validators' =&gt; [
           [
            'name' =&gt; 'EmailAddress',
            'options' =&gt; [
              'allow' =&gt; \Zend\Validator\Hostname::ALLOW_DNS,
              'useMxCheck' =&gt; false,                            
            ],
          ],
        ],
      ]
    );
        
    $inputFilter-&gt;add([
        'name'     =&gt; 'subject',
        'required' =&gt; true,
        'filters'  =&gt; [
           ['name' =&gt; 'StringTrim'],
           ['name' =&gt; 'StripTags'],
           ['name' =&gt; 'StripNewLines'],
        ],                
        'validators' =&gt; [
           [
            'name' =&gt; 'StringLength',
              'options' =&gt; [
                'min' =&gt; 1,
                'max' =&gt; 128
              ],
           ],
        ],
      ]
    );
    
    $inputFilter-&gt;add([
        'name'     =&gt; 'body',
        'required' =&gt; true,
        'filters'  =&gt; [                    
          ['name' =&gt; 'StripTags'],
        ],                
        'validators' =&gt; [
          [
            'name' =&gt; 'StringLength',
            'options' =&gt; [
              'min' =&gt; 1,
              'max' =&gt; 4096
            ],
          ],
        ],
      ]
    );                
  }  
}
</code></pre>
<p>As you can see from the code above, first we declare the alias for the
<code>Zend\InputFilter\InputFilter</code> class (line 3).</p>
<p>In the form model's constructor (line 10), we call the <code>addInputFilter()</code> method
which we define in lines 16-76. </p>
<p>The <code>addInputFilter()</code> method's goal is to create the <code>InputFilter</code> container 
(line 18), attach it to form model (line 19) and add filtering/
validation rules (lines 21-75). For attaching the input filter to the form model, we
use the <code>setInputFilter()</code> method provided by the <code>Form</code> base class. For inserting filtering/validation rules into the
input filter container, we use the <code>add()</code> method provided by the <code>InputFilter</code> class, which takes the array specification
of an input to create.</p>
<p>We add three inputs (per each field of our form model, except its submit button):</p>
<ul>
<li><p>For the <code>email</code> field, we set the <code>required</code> flag to <code>true</code> to make filling this
field mandatory. We use <code>StringTrim</code> filter to remove white spaces from the beginning
and the end of the E-mail address; and the <code>EmailAddress</code> validator for checking the
user-entered E-mail address for correctness. We configure the <code>EmailAddress</code> validator
to allow domain names as E-mail addresses (the <code>\Zend\Validator\Hostname::ALLOW_DNS</code> flag)
and disable MX record checking (set <code>useMxCheck</code> option to <code>false</code>).   </p>
</li>
<li><p>For the <code>subject</code> field, by analogy, we make it required, and use the <code>StringTrim</code> filter
to remove white spaces from the beginning and the end. Additionally, we use the <code>StripNewLines</code>
and <code>StripTags</code> filters to filter out the new line characters and HTML tags, respectively.
We constrain subject string length to be between 1 and 128 characters in length by using the
<code>StringLength</code> validator.</p>
</li>
<li><p>For the <code>body</code> field, we require it to be mandatory, and we use the <code>StripTags</code> filter
to strip HTML tags from E-mail text. We also use the <code>StringLength</code> validator to
constrain E-mail text to be between 1 and 4096 characters in length.</p>
</li>
</ul>
<p>In figure 7.16, you can find the schematic graphical representation of the input
filter we've created.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/input_filter.png">
<img src="images/forms/input_filter.png" alt="Figure 7.16. The input filter for ContactForm" /></a>
<span class="image-caption">Figure 7.16. The input filter for ContactForm</span>
</span>
</p>
<blockquote class="notquote tip" data-type="tip"><p> Above, we briefly described how to create an input filter for the form model. 
 For detailed information about the above mentioned (and other) filters and validators and their
 usage examples, please refer to <a href="Checking_Input_Data_with_Validators.html">Checking User Input with Validators</a>.</p>
</blockquote><h2 id="header-165">7.10. Using the Form in a Controller's Action</h2>
<p>When the form model class is ready, you finally can use the form in a 
controller's action method. </p>
<p>As you might already know, the way the site user works with form is typically 
an iterative process (schematically illustrated by figure 7.17):</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/form_workflow.png">
<img src="images/forms/form_workflow.png" alt="Figure 7.17. Typical form usage workflow" /></a>
<span class="image-caption">Figure 7.17. Typical form usage workflow</span>
</span>
</p>
<ul>
<li>First, you display the form and its fields on a web page, prompting user
for input. Once the user fills the form fields, he clicks the <em>Submit</em> button
and sends the data to server. </li>
<li>Next, your controller extracts the submitted
data and asks the form model to validate it. If there were input errors, you
display the form again, asking the user to correct input errors. If the data
is correct, you process the data with your business logic layer and (usually)
redirect the user to another web page. </li>
</ul>
<p>The <code>Form</code> base class provides several methods for accomplishing these (see table 7.7).</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.7. Methods provided by the Form base class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>setData($data)</code>               </td>
<td>  Sets form data for validation.                                </td>
</tr>
<tr>
<td> <code>getData($flag)</code>               </td>
<td> Retrieves the validated data.                                 </td>
</tr>
<tr>
<td> <code>isValid()</code>                    </td>
<td> Validates the form.                                           </td>
</tr>
<tr>
<td> <code>hasValidated()</code>               </td>
<td> Check if the form has been validated.                         </td>
</tr>
<tr>
<td> <code>getMessages($elementName = null)</code>                                 </td>
<td> Returns a list of validation failure messages, if any,       for a single element or for all form elements.                </td>
</tr>
</tbody>
</table>
</div>
<p>So, a generic form usage workflow is the following:</p>
<ul>
<li><p>Check whether the form data has been submitted, and if not, display the form on the web page.</p>
</li>
<li><p>If the data has been submitted by site user, the raw data 
is retrieved from <code>POST</code> (and/or <code>GET</code> ) variables in the form of an array.</p>
</li>
<li><p>The data is assigned to the form model's fields using the form's <code>setData()</code> method.</p>
</li>
<li><p>The filtering and validation is performed using the form's <code>isValid()</code> method 
(this results in executing the input filter attached to the form).
If a certain field(s) is/are invalid, display the form again and ask the user to correct their input.</p>
</li>
<li><p>As soon as the data has been filtered/validated you retrieve the data from the
form model using the <code>getData()</code> method and can pass the data to other models 
or use it any other way. </p>
</li>
</ul>
<p>The code example below illustrates how to implement this typical workflow in
your controller's action method:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Controller;

use Application\Form\ContactForm;
// ...

class IndexController extends AbstractActionController 
{
  // This action displays the feedback form
  public function contactUsAction() 
  {
    // Create Contact Us form
    $form = new ContactForm();
        
    // Check if user has submitted the form
    if($this-&gt;getRequest()-&gt;isPost()) 
    {
      // Fill in the form with POST data
      $data = $this-&gt;params()-&gt;fromPost();            
      $form-&gt;setData($data);
            
      // Validate form
      if($form-&gt;isValid()) {
                
        // Get filtered and validated data
        $data = $form-&gt;getData();
                
        // ... Do something with the validated data ...
		
        // Redirect to "Thank You" page
        return $this-&gt;redirect()-&gt;toRoute('application', ['action'=&gt;'thankYou']);
      }            
    } 
        
    // Pass form variable to view
    return new ViewModel([
          'form' =&gt; $form
       ]);
  }
}
</code></pre>
<p>In the code above, we define the <code>contactUsAction()</code> action method in the 
<code>IndexController</code> class (line 10). In the action method, we create an instance
of the <code>ContactForm</code> class (line 13).</p>
<p>Then, in line 16, we check whether the request is a POST request (checking 
the starting line of HTTP request). </p>
<p>In line 19 we retrieve the raw data submitted by the user. We extract all the POST variables
with the help of the <code>Params</code> controller plugin. The data is returned in the form of an array and
saved into the <code>$data</code> variable. </p>
<p>The data submitted by the user may contain mistakes and should be filtered and validated 
before further usage. To do that, in line 20 we set the data to the form model with the 
<code>setData()</code> method provided by the <code>Form</code> base class. We validate form data with the 
<code>isValid()</code> method (line 23), which returns <code>true</code> upon successful validation. 
If the validation succeeds, we retrieve the validated data using the <code>getData()</code> 
method (line 26) and then can pass the data to our business logic layer.</p>
<p>Once we have used the validated data, in line 31, we redirect the web user to the 
<em>Thank You</em> page. The redirect is performed with the <code>Redirect</code> controller plugin.
The <code>Redirect</code> plugin's <code>toRoute()</code> method takes two parameters: the first parameter is the
name of the route ("application/default"), and the second one is the array of parameters
to pass to the router. These identify the web page where you redirect the user.</p>
<blockquote class="notquote information" data-type="information"><p> We will prepare the controller's action and view template for the <em>Thank You</em>
 page a little bit later.</p>
</blockquote><p>In line 37, we pass the form model through the <code>$form</code> variable to the view template. The view template
will access this variable and will use it for rendering the form (and possible
validation errors).</p>
<h3 id="header-166">7.10.1. Passing Form Data to a Model</h3>
<p>To give you a real-life example of how you can use the validated data of the feedback form, 
in this section we will create a simple <code>MailSender</code> model <sup id="fnref:service"><a href="#fn:service" class="footnote-ref" rel="footnote">22</a></sup> class which
can be used for sending an E-mail message to an E-mail address. When the user submits the form, 
we will validate the form data and pass the validated data to the <code>MailSender</code> model and ask
it to send the E-mail message to the recipient. </p>
<footnotes id="fn:service"><p><sup>22)</sup> In DDD terms, the <code>MailSender</code> can be related to service models, because its goal 
is to manipulate data, not to store data.</p>
</footnotes>
<blockquote class="notquote tip" data-type="tip"><p> Reading this section is optional and intended mostly for beginners. You may skip it 
 and refer directly to the next section <em>Form Presentation</em>.</p>
</blockquote><p>The <code>MailSender</code> model will internally use the <code>Zend\Mail</code> component. The <code>Zend\Mail</code> component
is a component provided by Zend Framework 3 and designed to give you the convenient functionality
for composing mail messages (the <code>Zend\Mail\Message</code> class) and several classes implementing available 
transports for sending mail (in this example, we will use the <code>Mail\Transport\Sendmail</code> class which 
uses the <em>sendmail</em> program for delivering E-mails).</p>
<blockquote class="notquote information" data-type="information"><p> Install the <code>Zend\Mail</code> component with Composer by typing the following command:</p>
<p> <code>php composer.phar require zendframework\zend-mail</code></p>
</blockquote><blockquote class="notquote information" data-type="information"><p> The <a href="http://www.sendmail.com/sm/open_source/">sendmail</a> program is a free open-source mail transfer agent for Linux/Unix operating systems.
 It accepts messages that a PHP script passes to it, deciding based upon the message header which 
 delivery method it should use, and then passes the message through the SMTP protocol to the 
 appropriate mail server (like Google Mail) for delivery to the recipient. </p>
</blockquote><p>Start with creating the <em>MailSender.php</em> file under the <em>Service</em> directory under the module's
source directory (see figure 7.18 for example).</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/mailsender.png">
<img src="images/forms/mailsender.png" alt="Figure 7.18. Creating the MailSender.php File" /></a>
<span class="image-caption">Figure 7.18. Creating the MailSender.php File</span>
</span>
</p>
<p>The following is the code that should be put into the <em>MailSender.php</em> file:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Service;

use Zend\Mail;
use Zend\Mail\Message;
use Zend\Mail\Transport\Sendmail;

// This class is used to deliver an E-mail message to recipient.
class MailSender 
{
  // Sends the mail message.
  public function sendMail($sender, $recipient, $subject, $text) 
  {
    $result = false;
    try {
        
      // Create E-mail message
      $mail = new Message();
      $mail-&gt;setFrom($sender);
      $mail-&gt;addTo($recipient);
      $mail-&gt;setSubject($subject);
      $mail-&gt;setBody($text);
	  
      // Send E-mail message
      $transport = new Sendmail('-f'.$sender);
      $transport-&gt;send($mail);
      $result = true;
    } catch(\Exception $e) {
      $result = false;
    }
        
    // Return status 
    return $result;
  }
}
</code></pre>
<p>In the code above, we define the <code>Application\Service</code> namespace (line 2), because
the <code>MailSender</code> class can be related to service models (its goal is to manipulate
data, not to store it).</p>
<p>In lines 4-6, we declare the aliases for the <code>Mail</code>, <code>Message</code> and <code>Transport\Sendmail</code>
classes provided by the <code>Zend\Mail</code> component.</p>
<p>In lines 9-35, we define the <code>MailSender</code> class. The class has the single method
<code>sendMail()</code> (line 12), which takes four arguments: sender's E-mail address, recipient's E-mail address,
message subject and, finally, message body text.</p>
<p>In line 18, we create an instance of the <code>Message</code> class. We use the methods provided
by this class for composing the message (set its subject, body etc.) in lines 19-22.</p>
<p>In line 25, we create an instance of the <code>Sendmail</code> class, which uses the <em>sendmail</em>
program to pass the message to the appropriate mail server (see lines 25-26). Since the classes
provided by the <code>Zend\Mail</code> component may throw an exception on failure, we enclose the
block of code with the <code>try</code>-<code>catch</code> exception handler. </p>
<p>The <code>sendMail()</code> method will return <code>true</code> if the E-mail message sent successfully; otherwise
it will return <code>false</code> (line 33).</p>
<blockquote class="notquote information" data-type="information"><p> Configuring mail system for your web server is a rather complex task. It typically 
 requires installing sendmail and configuring the server's MX DNS record to use certain 
 mail server (either local mail server, e.g. <a href="http://www.postfix.org/">Posftix</a>, 
 or remote server, like Google Mail). 
 Because of the complexity of the topic, it is not discussed in this book. You can find 
 additional information on configuring mail for your particular system online.</p>
</blockquote><p>Finally, you can instantiate the <code>MailSender</code> model in your <code>IndexController::contactUsAction()</code>
method and pass it the validated form data. Below, the complete code for the <code>contactUsAction()</code>
method is presented:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
// ...
use Application\Service\MailSender;

class IndexController extends AbstractActionController 
{
  // ...  
  public function contactUsAction() {
        
    // Create Contact Us form
    $form = new ContactForm();
        
    // Check if user has submitted the form
    if($this-&gt;getRequest()-&gt;isPost()) {
            
      // Fill in the form with POST data
      $data = $this-&gt;params()-&gt;fromPost();            
            
      $form-&gt;setData($data);
            
      // Validate form
      if($form-&gt;isValid()) {
                
        // Get filtered and validated data
        $data = $form-&gt;getData();
        $email = $data['email'];
        $subject = $data['subject'];
        $body = $data['body'];
                
        // Send E-mail
        $mailSender = new MailSender();
        if(!$mailSender-&gt;sendMail('no-reply@example.com', $email, $subject, $body)) {
          // In case of error, redirect to "Error Sending Email" page
          return $this-&gt;redirect()-&gt;toRoute('application', ['action'=&gt;'sendError']);
        }
                
        // Redirect to "Thank You" page
        return $this-&gt;redirect()-&gt;toRoute('application', ['action'=&gt;'thankYou']);
      }            
    } 
        
    // Pass form variable to view
    return new ViewModel([
      'form' =&gt; $form
    ]);
  }
    
  // This action displays the Thank You page. The user is redirected to this
  // page on successful mail delivery.
  public function thankYouAction() 
  {
    return new ViewModel();
  }
    
  // This action displays the Send Error page. The user is redirected to this
  // page on mail delivery error.
  public function sendErrorAction() 
  {
    return new ViewModel();
  }
}
</code></pre>
<p>As you can see from the code above, we do the following:</p>
<ul>
<li><p>In line 3, we declare an alias for <code>Application\Service\MailSender</code> class.
This will allow you to refer to the model class by its short name.</p>
</li>
<li><p>In lines 26-28, after we've validated the form, we extract the validated
field values into the <code>$email</code>, <code>$subject</code> and <code>$body</code> PHP variables. </p>
</li>
<li><p>In line 31, we instantiate the <code>MailSender</code> class with the <code>new</code> operator;
in line 32, we call its <code>sendMail()</code> method and pass it four parameters:
the sender's address (here we use "no-reply@example.com", but you can replace
this with the address of your <em>sendmail</em>); the recipient's E-mail address, 
the E-mail subject and body. </p>
</li>
<li><p>If mail has been sent successfully (if the <code>sendMail()</code> method returned <code>true</code>), we
redirect the user to the <em>Thank You</em> page (line 40). On failure (if <code>sendMail()</code> 
method returned <code>false</code>), we redirect the user to the <em>Send Error</em> page (line 35).</p>
</li>
<li><p>In lines 53-55, we have the <code>thankYouAction()</code> method which displays the 
<em>Thank You</em> page. This page is shown if the E-mail message is sent successfully. </p>
</li>
<li><p>In line 59-61, we have the <code>sendErrorAction()</code> method which shows the 
<em>Error Sending Email</em> page. This page is shown on E-mail delivery failure.</p>
</li>
</ul>
<h2 id="header-167">7.11. Form Presentation</h2>
<p>When your controller's action is ready, all you have to do is prepare the <code>.phtml</code> 
view template file to display your form on a web page. In the view template, you need 
to define the markup using <code>&lt;form&gt;</code>, <code>&lt;label&gt;</code>, <code>&lt;input&gt;</code>, and possibly other HTML tags.</p>
<p>Additionally, you will have to display error messages if the form validation
failed. Because this work is rather boring, Zend Framework 3 provides you
with special view helpers intended for rendering the form. </p>
<blockquote class="notquote tip" data-type="tip"><p> For simple forms (which do not show error messages), you can use raw HTML tags 
 for rendering the form and ignore ZF3-provided form view helpers. 
 But, form view helpers are really unavoidable
 when rendering complex forms that may display validation errors and/or add
 fields dynamically.</p>
</blockquote><h3 id="header-168">7.11.1. Preparing the Form Model for Rendering</h3>
<p>Before rendering, it is required that you call the <code>prepare()</code> method on the form model's
instance (see table 7.8). If you forget to call this method, there may be undesired
effects.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.8. Methods provided by the Form base class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>prepare()</code>                    </td>
<td>  Ensures the form state is ready for use.                      </td>
</tr>
</tbody>
</table>
</div>
<p>The <code>prepare()</code> method does the following form model preparations:</p>
<ul>
<li><p>It calls the input filter container attached to the form model, 
to ensure validation error messages are available;</p>
</li>
<li><p>It prepares any elements and/or fieldsets that require preparation <sup id="fnref:wrapping"><a href="#fn:wrapping" class="footnote-ref" rel="footnote">23</a></sup>.</p>
</li>
</ul>
<footnotes id="fn:wrapping"><p><sup>23)</sup> Typically, this results in wrapping field names with the form/fieldset name 
(for example, the "email" field's name will become "contact-form[email]")
which technically results in a more convenient field grouping in a HTTP 
request body.  </p>
</footnotes>
<h2 id="header-169">7.12. Standard Form View Helpers</h2>
<p>Standard form view helpers provided by ZF3 are shown in table 7.9. These classes 
live in the <code>Zend\Form\View\Helper</code> namespace. As you can see from the table,
the view helpers can be divided into the following categories:</p>
<ul>
<li><p><em>Generic form view helpers.</em> These classes are designed to render the 
whole form (<code>Form</code> helper) or its single element (<code>FormElement</code> helper) 
and possible validation errors (<code>FormElementErrors</code> helper).</p>
</li>
<li><p><em>View helpers for rendering HTML fields of certain types.</em> These allow you to generate HTML 
markup for concrete form fields (e.g. <code>FormButton</code>, <code>FormRadio</code>, etc.) 
and a text label (<code>FormLabel</code>).</p>
</li>
<li><p><em>View helpers for rendering form fields introduced in HTML5.</em> These are 
analogous to the view helpers from the previous category, but intended for 
rendering HTML5 fields (e.g. <code>FormDate</code>, <code>FormUrl</code>, etc.)</p>
</li>
<li><p><em>Other view helpers.</em> In this category, we can put the view helper classes designed for rendering
ZF3-specific fields, like <code>FormMultiCheckbox</code>, <code>FormCaptcha</code>, etc.</p>
</li>
</ul>
<div class="table-wrapper">
<div class="table-caption">Table 7.9. View helpers designed for using with forms</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <em>Generic helpers</em>                </td>
<td>                                                                </td>
</tr>
<tr>
<td> <code>Form</code>                           </td>
<td> Renders the entire form and all its elements.                 </td>
</tr>
<tr>
<td> <code>FormElement</code>                    </td>
<td> Renders a generic form element.                               </td>
</tr>
<tr>
<td> <code>FormElementErrors</code>              </td>
<td> Renders validation errors for a form element.                 </td>
</tr>
<tr>
<td> <code>FormRow</code>                        </td>
<td> Renders the label, the field and validation errors.           </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.9. HTML 4 field helpers</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>FormButton</code>                     </td>
<td>  Renders the <code>&lt;button&gt;</code> form field.                            </td>
</tr>
<tr>
<td> <code>FormCheckbox</code>                   </td>
<td> Renders the <code>&lt;input type="checkbox"&gt;</code> field.                  </td>
</tr>
<tr>
<td> <code>FormFile</code>                       </td>
<td> Renders the <code>&lt;input type="file"&gt;</code> form field.                 </td>
</tr>
<tr>
<td> <code>FormHidden</code>                     </td>
<td> Renders the <code>&lt;input type="hidden"&gt;</code> form field.               </td>
</tr>
<tr>
<td> <code>FormInput</code>                      </td>
<td> Renders an <code>&lt;input&gt;</code> form field.                              </td>
</tr>
<tr>
<td> <code>FormImage</code>                      </td>
<td> Renders the <code>&lt;input type="image"&gt;</code> form field.                </td>
</tr>
<tr>
<td> <code>FormLabel</code>                      </td>
<td> Renders the <code>&lt;label&gt;</code> tag.                                    </td>
</tr>
<tr>
<td> <code>FormPassword</code>                   </td>
<td> Renders the <code>&lt;input type="password"&gt;</code> form field.             </td>
</tr>
<tr>
<td> <code>FormRadio</code>                      </td>
<td> Renders the <code>&lt;input type="radio"&gt;</code> form field.                </td>
</tr>
<tr>
<td> <code>FormReset</code>                      </td>
<td> Renders the <code>&lt;input type="reset"&gt;</code> form field.                </td>
</tr>
<tr>
<td> <code>FormSelect</code>                     </td>
<td> Renders the <code>&lt;select&gt;</code> dropdown field.                        </td>
</tr>
<tr>
<td> <code>FormSubmit</code>                     </td>
<td> Renders the <code>&lt;input type="submit"&gt;</code> form field.               </td>
</tr>
<tr>
<td> <code>FormText</code>                       </td>
<td> Renders the <code>&lt;input type="text"&gt;</code> form field.                 </td>
</tr>
<tr>
<td> <code>FormTextarea</code>                   </td>
<td> Renders the <code>&lt;textarea&gt;</code> multi-line text field.               </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.9. HTML 5 field helpers</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
<th>                                                         </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>FormColor</code>                      </td>
<td>  Renders the <code>&lt;input type="color"&gt;</code> HTML5 form field.          </td>
<td></td>
</tr>
<tr>
<td> <code>FormDate</code>                       </td>
<td> Renders the <code>&lt;input type="date"&gt;</code> HTML5 form field.           </td>
</tr>
<tr>
<td> <code>FormDateTime</code>                   </td>
<td> Renders the <code>&lt;input type="date"&gt;</code> HTML5 form field.           </td>
</tr>
<tr>
<td> <code>FormDateTimeLocal</code>              </td>
<td> Renders the <code>&lt;input type="datetime-local"&gt;</code> HTML5 form field. </td>
</tr>
<tr>
<td> <code>FormEmail</code>                      </td>
<td> Renders the <code>&lt;input type="email"&gt;</code> HTML5 form field.          </td>
</tr>
<tr>
<td> <code>FormMonth</code>                      </td>
<td> Renders the <code>&lt;input type="month"&gt;</code> HTML5 form field.          </td>
</tr>
<tr>
<td> <code>FormNumber</code>                     </td>
<td> Renders the <code>&lt;input type="number"&gt;</code> HTML5 form field.         </td>
</tr>
<tr>
<td> <code>FormRange</code>                      </td>
<td> Renders the <code>&lt;input type="range"&gt;</code> HTML5 form field.          </td>
</tr>
<tr>
<td> <code>FormTel</code>                        </td>
<td> Renders the <code>&lt;input type="tel"&gt;</code> HTML5 form field.            </td>
</tr>
<tr>
<td> <code>FormTime</code>                       </td>
<td> Renders the <code>&lt;input type="time"&gt;</code> HTML5 form field.           </td>
</tr>
<tr>
<td> <code>FormUrl</code>                        </td>
<td> Renders the <code>&lt;input type="url"&gt;</code> HTML5 form field.            </td>
</tr>
<tr>
<td> <code>FormWeek</code>                       </td>
<td> Renders the <code>&lt;input type="week"&gt;</code> HTML5 form field.           </td>
</tr>
</tbody>
</table>
</div>
<div class="table-wrapper">
<div class="table-caption">Table 7.9. Other helpers</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>FormCaptcha</code>                    </td>
<td>  Renders the CAPTCHA security field.                           </td>
</tr>
<tr>
<td> <code>FormDateSelect</code>                 </td>
<td> Renders the date select field.                                </td>
</tr>
<tr>
<td> <code>FormDateTimeSelect</code>             </td>
<td> Renders the datetime select field.                            </td>
</tr>
<tr>
<td> <code>FormMonthSelect</code>                </td>
<td> Renders the month select field.                               </td>
</tr>
<tr>
<td> <code>FormMultiCheckbox</code>              </td>
<td> Renders the multi checkbox field.                             </td>
</tr>
<tr>
<td> <code>FormCollection</code>                 </td>
<td> Renders the collection of elements.                           </td>
</tr>
</tbody>
</table>
</div>
<p>In the next sections, we will provide an overview of several frequently used form view helpers
and their usage examples.</p>
<h3 id="header-170">7.12.1. Rendering a Form Element</h3>
<p>You can render a form field with the <code>FormElement</code> view helper. It is designed to be as flexible
as possible and recognize as many field types as possible. So, with this view helper
you are able to produce HTML markup for text fields, buttons, dropdown lists and so on.</p>
<p>The methods provided by this view helper are listed in table 7.10. </p>
<div class="table-wrapper">
<div class="table-caption">Table 7.10. Methods provided by the FormElement view helper</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>render($element)</code>               </td>
<td>  PHP magic method which renders the given form field.          </td>
</tr>
<tr>
<td> <code>__invoke($element)</code>                                                </td>
<td> PHP magic method which renders the given form field             (the effect is the same as <code>render()</code>).                       </td>
</tr>
</tbody>
</table>
</div>
<p>As you can see, there are two methods doing the same thing:</p>
<ul>
<li>The <code>render()</code> method produces the HTML markup for the
form field. It accepts the single argument -- the instance of the element to render. You can
retrieve the form element with the form model's <code>get()</code> method (see example below).</li>
<li>The <code>__invoke()</code> method is a convenience wrapper which results in less code to write.</li>
</ul>
<pre class=""><code class="language-php">&lt;?php 
// We assume that the form model is stored in $form variable.
// Render the E-mail field with the render() method.
echo $this-&gt;formElement()-&gt;render($form-&gt;get('email')); ?&gt;

// The same, but with __invoke
echo $this-&gt;formElement($form-&gt;get('email')); 
</code></pre>
<p>When executed, the code above will generate the HTML code as follows:</p>
<pre class=""><code class="language-html">&lt;input type="text" name="email" id="email" value=""&gt;
</code></pre>
<blockquote class="notquote tip" data-type="tip"><p> Typically, there is no need to call view helpers for concrete HTML (or HTML5) 
 fields (e.g. <code>FormText</code>, <code>FormSubmit</code>, etc.)
 Instead, you can use the generic <code>FormElement</code> view helper which determines the
 field type automatically and produces the needed HTML code.</p>
</blockquote><h3 id="header-171">7.12.2. Rendering an Element's Validation Errors</h3>
<p>The <code>FormElementErrors</code> view helper class allows you to produce HTML markup for 
field validation errors (if present). If there are no validation errors for
certain element, this view helper does not produce any output.</p>
<p>An example of using the <code>FormElementErrors</code> view helper is presented below:</p>
<pre class=""><code class="language-php">&lt;?php 
// We assume that the form model is stored in $form variable.
// Render validation errors for the E-mail field.
echo $this-&gt;formElementErrors($form-&gt;get('email')); 
</code></pre>
<p>If there were any validation errors, this code will generate the unordered list
of errors using the <code>&lt;ul&gt;</code> HTML tag, and the list will contain as many items as 
there are errors for certain field. An example of such list for the E-mail field 
of our feedback form is presented below:</p>
<pre class=""><code class="language-html">&lt;ul&gt;
  &lt;li&gt;&amp;#039;hostname&amp;#039; is not a valid hostname for the email address&lt;/li&gt;
  &lt;li&gt;The input does not match the expected structure for a DNS hostname&lt;/li&gt;
  &lt;li&gt;The input appears to be a local network name but local network names are not allowed&lt;/li&gt;
&lt;/ul&gt; 
</code></pre>
<h3 id="header-172">7.12.3. Rendering an Element's Label</h3>
<p>The <code>FormLabel</code> helper allows you to render the text label for an element:</p>
<pre class=""><code class="language-php">&lt;?php 
// We assume that the form model is stored in $form variable.
// Render text label for the E-mail field.
echo $this-&gt;formLabel($form-&gt;get('email')); 
</code></pre>
<p>When executed, the code above will generate the HTML code as follows:</p>
<pre class=""><code class="language-html">&lt;label for="email"&gt;Your E-mail&lt;/label&gt;
</code></pre>
<h3 id="header-173">7.12.4. Rendering a Form Row</h3>
<p>The <code>FormRow</code> view helper is designed to simplify the rendering of a form field,
it's label, and validation errors. With this class, you are able to render these
in a single step. This helper is flexibly configurable, so you can apply a different
decoration to the form row. The methods of this view helper class are listed in table 7.11.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.11. Methods provided by the FormRow view helper</div><table>
<thead>
<tr>
<th> <em>Method name</em>                          </th>
<th> <em>Description</em>                                           </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>render($element)</code>                     </td>
<td>  Renders the form row.                                   </td>
</tr>
<tr>
<td> <code>__invoke($element, $labelPosition, $renderErrors, $partial)</code> </td>
<td> Renders the form row (convenience wrapper). </td>
</tr>
<tr>
<td> <code>setInputErrorClass($inputErrorClass)</code> </td>
<td> Sets input error CSS class.                             </td>
</tr>
<tr>
<td> <code>setLabelAttributes($labelAttributes)</code> </td>
<td> Sets label attributes.                                  </td>
</tr>
<tr>
<td> <code>setLabelPosition($labelPosition)</code>     </td>
<td> Sets label position (before or after the field).        </td>
</tr>
<tr>
<td> <code>setRenderErrors($renderErrors)</code>       </td>
<td> Set if the errors are rendered by this helper.          </td>
</tr>
<tr>
<td> <code>setPartial($partial)</code>                 </td>
<td> Set a partial view script to use for rendering the row. </td>
</tr>
</tbody>
</table>
</div>
<p>An example of using the <code>FormRow</code> view helper is presented below:</p>
<pre class=""><code class="language-php">&lt;?php 
// We assume that the form model is stored in $form variable.
// Render the E-mail field, its label and (possible) validation errors.
echo $this-&gt;formRow($form-&gt;get('email')); 
</code></pre>
<p>When executed, the code above will generate the HTML code as follows:</p>
<pre class=""><code class="language-html">&lt;label for="email"&gt;Your E-mail&lt;/label&gt;
&lt;input type="text" name="email" id="email"&gt;
&lt;ul&gt;
  &lt;li&gt;&amp;#039;hostname&amp;#039; is not a valid hostname for the email address&lt;/li&gt;
  &lt;li&gt;The input does not match the expected structure for a DNS hostname&lt;/li&gt;
  &lt;li&gt;The input appears to be a local network name but local network names 
      are not allowed&lt;/li&gt;
&lt;/ul&gt; 
</code></pre>
<h3 id="header-174">7.12.5. Rendering the Entire Form</h3>
<p>The <code>Form</code> view helper allows you to render the opening <code>&lt;form&gt;</code> tag and its attributes; 
and the closing <code>&lt;/form&gt;</code> tag. But its major purpose is to render the entire form and 
all of its fields with a single line of code. Public methods of the <code>Form</code> view helper 
class are summarized in table 7.12.</p>
<div class="table-wrapper">
<div class="table-caption">Table 7.12. Methods provided by the Form view helper</div><table>
<thead>
<tr>
<th> <em>Method name</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>render($form)</code>                  </td>
<td>  Renders the entire form and all its elements.                 </td>
</tr>
<tr>
<td> <code>__invoke($form)</code>                                                   </td>
<td> PHP magic method which renders the entire form and all its      elements (the effect is the same as <code>render()</code>).              </td>
</tr>
<tr>
<td> <code>openTag($form)</code>                 </td>
<td> Renders the opening <code>&lt;form&gt;</code> tag.                             </td>
</tr>
<tr>
<td> <code>closeTag()</code>                     </td>
<td> Renders the closing <code>&lt;/form&gt;</code> tag.                            </td>
</tr>
</tbody>
</table>
</div>
<p>You can render the whole form with the help of the <code>Form</code>'s <code>render()</code> method as follows:</p>
<pre class=""><code class="language-php">// We assume that the form model is stored in $form variable

// Render the whole form
echo $this-&gt;form()-&gt;render($form);
</code></pre>
<p>The same effect can be achieved with the <code>__invoke</code> magic method (see example below):</p>
<pre class=""><code class="language-php">// The same, but with `__invoke`
echo $this-&gt;form($form);
</code></pre>
<h2 id="header-175">7.13. Example: Creating the View Template for the Contact Form</h2>
<p>Now we are ready to define the presentation for our feedback form. 
If you remember, earlier we added the <em>contact-us.phtml</em> 
view template in <em>application/index/</em> directory under the module's 
<em>view/</em> directory. Replace the code in that file with the following:</p>
<pre class="line-numbers"><code class="language-text">&lt;?php
$form = $this-&gt;form;
$form-&gt;prepare();
?&gt;

&lt;?= $this-&gt;form()-&gt;openTag($form); ?&gt;
	
&lt;?= $this-&gt;formLabel($form-&gt;get('email')); ?&gt;
&lt;?= $this-&gt;formElement($form-&gt;get('email')); ?&gt;
&lt;?= $this-&gt;formElementErrors($form-&gt;get('email')); ?&gt;                  
	
&lt;?= $this-&gt;formLabel($form-&gt;get('subject')); ?&gt;
&lt;?= $this-&gt;formElement($form-&gt;get('subject')); ?&gt;
&lt;?= $this-&gt;formElementErrors($form-&gt;get('subject')); ?&gt;
   
&lt;?= $this-&gt;formLabel($form-&gt;get('body')); ?&gt;
&lt;?= $this-&gt;formElement($form-&gt;get('body')); ?&gt;
&lt;?= $this-&gt;formElementErrors($form-&gt;get('body')); ?&gt;                  
	
&lt;?= $this-&gt;formElement($form-&gt;get('submit')); ?&gt;
	
&lt;?= $this-&gt;form()-&gt;closeTag(); ?&gt;
</code></pre>
<p>As you can see from the code above, we do the following things to render the form:</p>
<ul>
<li><p>In line 2, we access the <code>$form</code> variable passed from the controller's action. </p>
</li>
<li><p>In line 3, we call the <code>Form</code>'s <code>prepare()</code> method to prepare the form for rendering.
Please note that calling this method is very important. If you forget to do that,
there may be some undesired rendering problems.</p>
</li>
<li><p>In line 6, we call the <code>openTag()</code> method of the <code>Form</code> view helper. Its purpose is
to render the opening <code>&lt;form&gt;</code> tag and its attributes. The method takes a single
argument -- an instance of the form model. Paired closing <code>&lt;/form&gt;</code> tag
is rendered in line 23 with the help of the <code>closeTag()</code> method of the <code>Form</code> view 
helper.</p>
</li>
<li><p>In lines 8-10, we render the E-mail field's label, the text field itself and (possible) 
validation errors with the help of the <code>FormLabel</code>, <code>FormElement</code> and <code>FormElementErrors</code>
view helpers. Those helpers take the instance of the form model's element as a single argument. We
get an instance of the element with the <code>get()</code> method provided by the <code>Form</code> base class.</p>
</li>
<li><p>In lines 12-14, by analogy, we render the Subject field, its label and validation errors.</p>
</li>
<li><p>And in lines 16-18, we render the label, the field and the validation errors for the 
body text area field. </p>
</li>
<li><p>In line 20, we render the <em>Submit</em> button.</p>
</li>
</ul>
<p>When the view template renderer evaluates this code, it will produce the HTML output like below:</p>
<pre class=""><code class="language-html">&lt;form action="/contact" method="post" name="contact-form"&gt;
  &lt;label for="email"&gt;Your E-mail&lt;/label&gt;
  &lt;input type="text" name="email" id="email" value=""&gt;
        
  &lt;label for="subject"&gt;Subject&lt;/label&gt;
  &lt;input name="subject" type="text" id="subject" value=""&gt;

  &lt;label for="body"&gt;Message Body&lt;/label&gt;
  &lt;textarea name="body" id="body"&gt;&lt;/textarea&gt;
       
  &lt;input name="submit" type="submit" value="Submit"&gt;
&lt;/form&gt;
</code></pre>
<blockquote class="notquote information" data-type="information"><p> In the code above, we mostly used the <code>FormElement</code>, <code>FormElementErrors</code>
 and <code>FormLabel</code> view helpers. You may use the generic <code>FormRow</code> or <code>Form</code> view
 helpers if you want to reduce the amount of code to write, but this
 may result in less control of form decoration.</p>
</blockquote><p>If certain fields have validation errors, those errors will be
outputted below the field in the form of the <code>&lt;ul&gt;</code> unordered HTML list.
For example, if you enter the "123@hostname" into E-mail form field,
you would receive the following validation errors:</p>
<pre class=""><code class="language-html">&lt;label for="email"&gt;Your E-mail&lt;/label&gt;
&lt;input type="text" name="email" value="123@hostname"&gt;
&lt;ul&gt;
  &lt;li&gt;&amp;#039;hostname&amp;#039; is not a valid hostname for the email address&lt;/li&gt;
  &lt;li&gt;The input does not match the expected structure for a DNS hostname&lt;/li&gt;
  &lt;li&gt;The input appears to be a local network name but local network names 
      are not allowed&lt;/li&gt;
&lt;/ul&gt; 
</code></pre>
<h3 id="header-176">7.13.1. Applying the Bootstrap CSS Styles to Form</h3>
<p>The HTML markup above is missing CSS styling. What we want to achieve is to use
Twitter Bootstrap CSS classes to give the form a nice, professional-looking
appearance. To add Bootstrap styling to the form, you have to modify the code in the <em>.phtml</em>
file to make it look like below:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
$form = $this-&gt;form;
$form-&gt;prepare();

$form-&gt;get('email')-&gt;setAttributes([
  'class'=&gt;'form-control', 
  'placeholder'=&gt;'name@example.com'
  ]);
  
$form-&gt;get('subject')-&gt;setAttributes([
  'class'=&gt;'form-control', 
  'placeholder'=&gt;'Type subject here'
  ]);
  
$form-&gt;get('body')-&gt;setAttributes([
  'class'=&gt;'form-control', 
  'rows'=&gt;6, 
  'placeholder'=&gt;'Type message text here'
  ]);
  
$form-&gt;get('submit')-&gt;setAttributes(['class'=&gt;'btn btn-primary']);
?&gt;

&lt;h1&gt;Contact Us&lt;/h1&gt;

&lt;p&gt;
  Please fill out the following form to contact us. 
  We appreciate your feedback. 
&lt;/p&gt;

&lt;div class="row"&gt;
  &lt;div class="col-md-6"&gt;
    &lt;?= $this-&gt;form()-&gt;openTag($form); ?&gt;
        
    &lt;div class="form-group"&gt;
      &lt;?= $this-&gt;formLabel($form-&gt;get('email')); ?&gt;
      &lt;?= $this-&gt;formElement($form-&gt;get('email')); ?&gt;
      &lt;?= $this-&gt;formElementErrors($form-&gt;get('email')); ?&gt;
    &lt;/div&gt;
        
    &lt;div class="form-group"&gt;
      &lt;?= $this-&gt;formLabel($form-&gt;get('subject')); ?&gt;
      &lt;?= $this-&gt;formElement($form-&gt;get('subject')); ?&gt;
      &lt;?= $this-&gt;formElementErrors($form-&gt;get('subject')); ?&gt;
    &lt;/div&gt;
        
    &lt;div class="form-group"&gt;
      &lt;?= $this-&gt;formLabel($form-&gt;get('body')); ?&gt;
      &lt;?= $this-&gt;formElement($form-&gt;get('body')); ?&gt;
      &lt;?= $this-&gt;formElementErrors($form-&gt;get('body')); ?&gt;
    &lt;/div&gt;
        
    &lt;?= $this-&gt;formElement($form-&gt;get('submit')); ?&gt;
        
    &lt;?= $this-&gt;form()-&gt;closeTag(); ?&gt;
  &lt;/div&gt;    
&lt;/div&gt;
</code></pre>
<p>In the code above, we added the <code>.form-control</code> CSS class to every 
input field in the form. We did that with the <code>setAttribute()</code> method (see lines 5, 10 and 15).
With that method, we also added the "placeholder" attribute to define the
nice-looking placeholder text when a field is empty. For the "body" field,
we added the "rows" attribute defining the height of the field (6 rows).</p>
<p>For the form's <em>Submit</em> button, we use the <code>.btn</code> and <code>.btn-primary</code> 
CSS classes (see line 21).</p>
<p>We also put label-input pairs inside of <code>&lt;div&gt;</code> elements with <code>.form-group</code> 
CSS class (lines 35, 41, 47).  </p>
<p>We put a form inside of the 6-column-width grid cell, which makes the form half 
the width of the screen (look at lines 31-32).</p>
<h3 id="header-177">7.13.2. Styling the Validation Errors List</h3>
<p>The error messages on your form, by default, look like a typical unordered list (<code>&lt;ul&gt;</code>). To 
give them a nice visual appearance, we add a couple of CSS rules to the <em>style.css</em> file
in <em>APP_DIR/public</em> directory:</p>
<pre class=""><code class="language-css">form ul {
  list-style-type: none;
  padding: 0px;
  margin: 0px 5px;
}

form ul li {    
  color: red;        
}
</code></pre>
<p>The CSS rules above will remove bullets from the list and make 
validation error messages appear in red. </p>
<h3 id="header-178">7.13.3. Adding the "Thank You" &amp; "Error Sending Email" Pages</h3>
<p>The last small thing we will do is preparing the view templates
for the "Thank You" and "Error Sending Email" pages.</p>
<p>Add the <em>thank-you.phtml</em> view template in <em>application/index/</em> directory under 
the module's <em>view/</em> directory. Put the following HTML markup into the view template file:</p>
<pre class=""><code class="language-html">&lt;h1&gt;Thank You!&lt;/h1&gt;

&lt;p&gt;
  &lt;div class="alert alert-success"&gt;
    We will respond to the E-mail address you have provided.
  &lt;/div&gt;
&lt;/p&gt;
</code></pre>
<p>Next, add the <em>send-error.phtml</em> view template file. 
The HTML markup for the <em>Error Sending Email</em> page is presented below:</p>
<pre class=""><code class="language-html">&lt;h1&gt;Error Sending Email!&lt;/h1&gt;

&lt;p&gt;
  &lt;div class="alert alert-warning"&gt;
    Sorry, but we had an unexpected problem when trying to deliver 
    your message. Please try again later.
  &lt;/div&gt;
&lt;/p&gt;
</code></pre>
<h3 id="header-179">7.13.4. Results</h3>
<p>Congratulations! Now, if you open the "http://localhost/contactus" 
URL in your web browser, you should see a page like that shown in figure 7.19.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/contact_form.png">
<img src="images/forms/contact_form.png" alt="Figure 7.19. Contact Form" /></a>
<span class="image-caption">Figure 7.19. Contact Form</span>
</span>
</p>
<p>If you enter some invalid data in the form and click the Submit button, you should
see the validation errors (figure 7.20).</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/validation_errors_page.png">
<img src="images/forms/validation_errors_page.png" alt="Figure 7.20. Form validation errors" /></a>
<span class="image-caption">Figure 7.20. Form validation errors</span>
</span>
</p>
<p>Entering the correct E-mail, subject and message text and submitting the 
form results in sending the message and displaying the <em>Thank You</em> page (see figure 7.21).</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/thank_you_page.png">
<img src="images/forms/thank_you_page.png" alt="Figure 7.21. Thank You page" /></a>
<span class="image-caption">Figure 7.21. Thank You page</span>
</span>
</p>
<p>On a sending failure, you will see the <em>Error Sending Email</em> page (see figure 7.22 for example):</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/forms/send_error_page.png">
<img src="images/forms/send_error_page.png" alt="Figure 7.22. Error Sending Email page" /></a>
<span class="image-caption">Figure 7.22. Error Sending Email page</span>
</span>
</p>
<blockquote class="notquote tip" data-type="tip"><p> You can see the <em>Contact Us</em> form in action in the <em>Form Demo</em> sample
 application bundled with this book.</p>
</blockquote><h2 id="header-180">7.14. Summary</h2>
<p>Forms are the way of collecting user-entered data on web pages. A form usually
consists of elements (input field + label pairs). Elements can optionally be 
grouped into fieldsets. </p>
<p>In an MVC-based web site, form functionality is separated into form models 
responsible for element definition and validation, and form presentation 
implemented with the help of special view helpers.</p>
<p>To create a form model, you write a class deriving from the <code>Form</code> base class.
The form model is initialized by adding its elements with the help of the base 
class-provided methods. </p>
<p>To submit form data to the server, the user clicks the <em>Submit</em> button, then the data 
is sent as part of a HTTP request. Once the user submits the form, you can extract the
form data in your controller and ask the form model to validate it.</p>
<p>For checking and filtering the user-entered data, filters and validators
are utilized. You use the <code>InputFilter</code> class which is the container for validation
rules.</p>
<p>If there are input errors, you display the form again, asking the user to correct the
input errors. If the data is correct, you process the data with your business logic layer.</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
ï»¿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="Page_Appearance_and_Layout.html">
            <img alt="Previous Chapter" src="../assets/images/left.png"><span>Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="toc.html">
            <img alt="Contents" src="../assets/images/book.png"><span>Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="Transforming_Input_Data_with_Filters.html">
            <span>Next</span><img alt="Next Chapter" src="../assets/images/right.png">
        </a>
            </div>    
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2016 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a> on 2016-08-04 at 15:31            </div>
        </div>    
    </div>
</footer>

<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/cssrelpreload.js"></script>

<script src="../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

