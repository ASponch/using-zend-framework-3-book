<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework 3">
<meta name="keywords" content="zend framework book,free zend framework book,zf3 book,free zf3 book,zend book">
<meta name="author" content="(c) 2016 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Model-View-Controller -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework 3            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="Website_Operation.html">
            <img alt="Previous Chapter" src="../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="toc.html">
            <img alt="Contents" src="../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="Routing.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../assets/images/right.png">
        </a>
            </div>    
</div>

ï»¿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">

<h1 id="mvc">4. Model-View-Controller</h1>
<p>In this chapter, you will learn about the models, views and controllers (the MVC design pattern). 
A web application uses the MVC pattern to separate business logic from presentation. 
The goal of this is to allow for code reusability and separation of concerns.</p>
<p>ZF3 components covered in this chapter:</p>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th> <em>Component</em>                    </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Zend\Mvc</code>                     </td>
<td>  Support of MVC pattern. Implements base controller classes, controller plugins, etc. </td>
</tr>
<tr>
<td> <code>Zend\View</code>                    </td>
<td> Implements the functionality for variable containers, rendering a web page and common view helpers. </td>
</tr>
<tr>
<td> <code>Zend\Http</code>                    </td>
<td> Implements a wrapper around HTTP request and response.        </td>
</tr>
</tbody>
</table>
</div>
<h2 id="header-69">4.1. Get the Hello World Example from GitHub</h2>
<p>In this and in the next chapters, we will provide some code samples that you may want to
reproduce yourself. It may be difficult for a novice to write code without mistakes. If you are stuck or can not 
understand why your code does not work, you can download the complete <em>Hello 
World</em> web application from GitHub code hosting. The sample from this chapter are mostly the part of
this sample application. </p>
<p>To download the Hello World application, visit <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">this page</a>
and click the <em>Clone or Download</em> button to download the code as a ZIP archive (see figure 4.1). 
When download is complete, unpack the archive to some directory.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/preface/samples_on_github.png">
<img src="images/preface/samples_on_github.png" alt="Figure 4.1. The Hello World sample can be downloaded from GitHub" /></a>
<span class="image-caption">Figure 4.1. The Hello World sample can be downloaded from GitHub</span>
</span>
</p>
<p>Then navigate to the <code>helloworld</code> directory containing the complete 
source code of the <em>Hello World</em> example:</p>
<pre class=""><code class="language-text">/using-zf3-book-samples
   /helloworld
     ...
</code></pre>
<p>The Hello World is a complete web site which can be installed on your machine.
To install the example, you can either edit your default Apache virtual host file
or create a new one. After editing the file, restart the Apache HTTP Server
and open the web site in your web browser.</p>
<h2 id="header-70">4.2. Separating Business Logic from Presentation</h2>
<p>A typical website has three kinds of functionality: code implementing business logic, 
code implementing user interaction and code rendering HTML pages (presentation). 
Before PHP frameworks, programmers usually merged these three types of code in a single
big PHP script file, which made it a pain to test and maintain such code, especially
when you write a large website. </p>
<p>Since that time, PHP became object-oriented, and now you can organize your code into classes.
The <em>Model-View-Controller</em> (MVC) pattern is just a set of advices telling you how to organize
your classes in a better manner, to make them easy to maintain. </p>
<p>In MVC, classes implementing your business logic are called <em>models</em>, code snippets
rendering HTML pages are called <em>views</em>, and the classes responsible for interacting with user
are called <em>controllers</em>. </p>
<blockquote class="notquote information" data-type="information"><p> Views are implemented as <em>code snippets</em>, not as classes. This is because
 views are typically very simple and contain only the mixture of HTML and inline PHP code.</p>
</blockquote><p>The main objective of the MVC concept is to separate the business logic (models) 
from its visualization (views). This is also called the <em>separation of concerns</em>, when each layer
does its specific tasks only.</p>
<p>By separating your models from views, you reduce the number of dependencies between them.
Therefore, changes made to one of the layers have the lowest possible impact on other 
layers. This separation also improves the <em>code reusability</em>. For example,
you can create multiple visual representations for the same models (changeable themes).</p>
<p>To better understand how this works, lets remember that any web site is just a PHP
program receiving an HTTP request from the web server, and producing an HTTP response.
Figure 4.2 shows how an HTTP request is processed by the MVC application
and how the response is generated:</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/model-view-controller.png">
<img src="images/mvc/model-view-controller.png" alt="Figure 4.2. HTTP request processing in an MVC web application" /></a>
<span class="image-caption">Figure 4.2. HTTP request processing in an MVC web application</span>
</span>
</p>
<ul>
<li><p>First, a website visitor enters a URL in his/her web browser, for example <em>http://localhost</em>, and the web browser
sends the request to the web server over the Internet.</p>
</li>
<li><p>Web server's PHP engine runs the <em>index.php</em> entry script. The only thing the entry script
does is creating the <code>Zend\Mvc\Application</code> class instance.</p>
</li>
<li><p>The application uses its <em>router</em> component for parsing the URL and determining 
to which controller to pass the request. If the route match is found, the 
controller is instantiated and its appropriate <em>action method</em> is called.</p>
</li>
<li><p>In the controller's action method, parameters are retrieved from 
GET and POST variables. To process the incoming data, the controller
instantiates appropriate model classes and calls their methods. </p>
</li>
<li><p>Model classes use business logic algorithms to process the input data 
and return the output data. The business logic algorithms are application-specific,
and typically include retrieving data from database, managing files, interacting
with external systems and so on.</p>
</li>
<li><p>The result of calling the models are passed to the corresponding 
view script for the rendering of the HTML page.</p>
</li>
<li><p>View script uses the model-provided data for rendering the HTML page.</p>
</li>
<li><p>Controller passes the resulting HTTP response to application.</p>
</li>
<li><p>Web server returns the resulting HTML web page to the user's web browser.</p>
</li>
<li><p>The user sees the page in browser window. </p>
</li>
</ul>
<p>Now you might have some idea how models, views and controllers cooperate
to generate HTML output. In the next sections, we describe them in more details.</p>
<h2 id="header-71">4.3. Controllers</h2>
<p>A controller provides communication between the application, models and views: 
gets input from HTTP request and uses the model(s) and the corresponding view 
to produce the necessary HTTP response.</p>
<p>Controllers belonging to module typically reside in the <code>Controller</code> subdirectory 
of module's source directory (shown in figure 4.3).</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/controller_dir.png">
<img src="images/mvc/controller_dir.png" alt="Figure 4.3. Controller directory" /></a>
<span class="image-caption">Figure 4.3. Controller directory</span>
</span>
</p>
<p>Zend Skeleton Application provides you with the default implementation of <code>IndexController</code> 
class. The <code>IndexController</code> is typically the main controller class of the web site. Its code 
is presented below (some parts of code were omitted for simplicity):  </p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Controller;

use Zend\Mvc\Controller\AbstractActionController;
use Zend\View\Model\ViewModel;

class IndexController extends AbstractActionController
{
    public function indexAction()
    {
        return new ViewModel();
    }
}
</code></pre>
<p>From the example above, you can see that controllers usually define their own namespace (line 2). 
The Index controller, as all other controllers from the <em>Application</em> module, lives in <code>Application\Controller</code> 
namespace.</p>
<p>A controller is a usual PHP class derived from the <code>AbstractActionController</code> base class (line 7). </p>
<p>By default, the controller class contains the single <em>action method</em> called <code>indexAction()</code> (see lines 9-12).
Typically, you will create other action methods in your controller classes. </p>
<blockquote class="notquote tip" data-type="tip"><p> ZF3 automatically recognizes the action methods by the <code>Action</code> suffix. 
 If a controller method's name does not have that suffix, it is considered as a usual method, not an action.</p>
</blockquote><p>As its name assumes, an action method performs some site action, 
which typically results in producing a single web page. Index controller usually
contains action methods for site-wide web pages (table 4.1). For example, you would have 
"index" action for the <em>Home</em> page, "about" action for <em>About</em> page,
"contactUs" action for the <em>Contact Us</em> page and possibly other actions.</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.1. Index controller's typical actions</div><table>
<thead>
<tr>
<th> <em>Action Method</em>                    </th>
<th> <em>Description</em>                                    </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>IndexController::indexAction()</code>                                        </td>
<td>  The "index" action displays the Home page of your  site.                                            </td>
</tr>
<tr>
<td> <code>IndexController::aboutAction()</code>                                                                             </td>
<td> The "about" action displays the About page of      the site. The About page contains contact and      copyright information.                           </td>
</tr>
<tr>
<td> <code>IndexController::contactUsAction()</code>                                                                          </td>
<td> The "contactUs" action displays the Contact Us     page of the site. The Contact Us page displays     the form for contacting site authors.            </td>
</tr>
</tbody>
</table>
</div>
<h3 id="header-72">4.3.1. Base Controller Class</h3>
<p>Every controller in your web site is inherited from the <code>AbstractActionController</code> base class.
In figure 4.4, the class inheritance diagram is presented.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/controller_inheritance.png">
<img src="images/mvc/controller_inheritance.png" alt="Figure 4.4. Controller inheritance diagram" /></a>
<span class="image-caption">Figure 4.4. Controller inheritance diagram</span>
</span>
</p>
<p>The <code>AbstractActionController</code> provides you with several useful methods you can use
in your controller classes. Table 4.2 provides you with a brief summary of the methods:</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.2. AbstractActionController's useful methods</div><table>
<thead>
<tr>
<th> <em>Method Name</em>                    </th>
<th> <em>Description</em>                                          </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>getRequest()</code>                                                      </td>
<td>  Retrieves the <code>Zend\Http\Request</code> object, which is the   representation of HTTP request data.                   </td>
</tr>
<tr>
<td> <code>getResponse()</code>                                                     </td>
<td> Retrieves the <code>Zend\Http\PhpEnvironment\Response</code> object  allowing to set data of HTTP response.                 </td>
</tr>
<tr>
<td> <code>getEventManager()</code>                                                 </td>
<td> Returns the <code>Zend\EventManager\EventManager</code> object,     allowing to trigger events and listen to events.       </td>
</tr>
<tr>
<td> <code>getEvent()</code>                                                        </td>
<td> Returns the <code>Zend\Mvc\MvcEvent</code> object, which represents  the event the controller responds to.                  </td>
</tr>
<tr>
<td> <code>getPluginManager()</code>                                                </td>
<td> Returns the <code>Zend\Mvc\Controller\PluginManager</code> object,  which can be used for registering controller plugins.  </td>
</tr>
<tr>
<td> <code>plugin($name, $options)</code>                                           </td>
<td> This method allows to access certain controller  plugin  with the given name.                                   </td>
</tr>
<tr>
<td> <code>__call($method, $params)</code>                                          </td>
<td> Allows to call a plugin indirectly using the PHP <code>__call</code>   magic method.                                          </td>
</tr>
</tbody>
</table>
</div>
<p>As you can see from the table above, the base controller class provides you with access to HTTP request
and response data, and provides you with the access to the event manager.
It also gives you an ability to register and call controller plugins (we will learn about controller
plugins later in this chapter).</p>
<h3 id="header-73">4.3.2. Retrieving Data from HTTP Request</h3>
<p>In a controller's action method, you may need to retrieve the data from the HTTP request 
(the data like GET and POST variables, cookies, HTTP headers and so on). For this purpose, Zend Framework 3 
provides you with <code>Zend\Http\Request</code> and <code>Zend\Http\PhpEnvironment\Response</code> classes, 
which are part of <code>Zend\Http</code> component.</p>
<p>To get the HTTP request object, inside of your action method, you can use the following code:</p>
<pre class=""><code class="language-php">// Get HTTP request object
$request = $this-&gt;getRequest();
</code></pre>
<p>The code above returns the instance of <code>Zend\Http\Request</code> class, containing all the HTTP 
request data. In table 4.3, you can find the most widely used methods of the <code>Request</code> class together 
with their brief description.</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.3. Methods of `Zend\Http\Request` class.</div><table>
<thead>
<tr>
<th> Method Name                            </th>
<th> Description                                          </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>isGet()</code>                              </td>
<td>  Checks if this is a GET request.                     </td>
</tr>
<tr>
<td> <code>isPost()</code>                             </td>
<td> Checks if this is a POST request.                    </td>
</tr>
<tr>
<td> <code>isXmlHttpRequest()</code>                   </td>
<td> Checks if this request is an AJAX request.           </td>
</tr>
<tr>
<td> <code>isFlashRequest()</code>                     </td>
<td> Check if this request is a Flash request.            </td>
</tr>
<tr>
<td> <code>getMethod()</code>                          </td>
<td> Returns the method for this request.                 </td>
</tr>
<tr>
<td> <code>getUriString()</code>                       </td>
<td> Returns the URI for this request object as a string. </td>
</tr>
<tr>
<td> <code>getQuery($name, $default)</code>                                                     </td>
<td> Returns the query parameter by name, or all query parameters.   If a parameter is not found, returns the <code>$default</code> value.</td>
</tr>
<tr>
<td> <code>getPost($name, $default)</code>                                                      </td>
<td> Returns the parameter container responsible for post   parameters or a single post parameter.               </td>
</tr>
<tr>
<td> <code>getCookie()</code>                            </td>
<td> Returns the Cookie header.                            </td>
</tr>
<tr>
<td> <code>getFiles($name, $default)</code>                                                     </td>
<td> Returns the parameter container responsible for file   parameters or a single file.                         </td>
</tr>
<tr>
<td> <code>getHeaders($name, $default)</code>                                                   </td>
<td> Returns the header container responsible for headers   or all headers of a certain name/type.               </td>
</tr>
<tr>
<td> <code>getHeader($name, $default)</code>                                                    </td>
<td> Returns a header by <code>$name</code>. If a header is not found,     returns the <code>$default</code> value.                        </td>
</tr>
<tr>
<td> <code>renderRequestLine()</code>                                                           </td>
<td> Returns the formatted request line (first line) for    this HTTP request.                                   </td>
</tr>
<tr>
<td> <code>fromString($string)</code>                                                           </td>
<td> A static method that produces a Request object from a  well-formed Http Request string                      </td>
</tr>
<tr>
<td> <code>toString()</code>                           </td>
<td> Returns the raw HTTP request as a string.            </td>
</tr>
</tbody>
</table>
</div>
<h3 id="header-74">4.3.3. Retrieving GET or POST Variables</h3>
<p>To simply get a GET or POST variable from an HTTP request, you use the following code:</p>
<pre class="line-numbers"><code class="language-php">// Get a variable from GET
$getVar = $this-&gt;params()-&gt;fromQuery('var_name', 'default_val');

// Get a variable from POST
$postVar = $this-&gt;params()-&gt;fromPost('var_name', 'default_val');
</code></pre>
<p>In the example above, we used the <code>Params</code> controller plugin, which provides you with
convenient methods of accessing GET and POST variables, uploaded files, etc.</p>
<p>In line 2 we use the <code>fromQuery()</code> method for retrieving a variable having name "var_name" from GET.
If such a variable does not present, the default value "default_val" is returned.
The default value is very convenient, because you don't have to use the <code>isset()</code> PHP
function to test if the variable exists.</p>
<p>In line 5 we use the <code>fromPost()</code> method to retrieve the variable from POST. The meaning
of this method's parameters is the same as for the <code>fromQuery()</code> method.</p>
<blockquote class="notquote tip" data-type="tip"><p> In ZF3, you must not access request parameters through traditional PHP <code>$_GET</code> and <code>$_POST</code>
 global arrays. Instead, you use ZF3-provided API for retrieving the request data.</p>
</blockquote><h3 id="header-75">4.3.4. Putting Data to HTTP Response</h3>
<p>Although you typically do not interact with HTTP response data directly, you can do that
with the help of <code>getResponse()</code> method provided by <code>AbstractActionController</code> base class.
Table 4.4 contains the most important methods of the <code>Response</code> class:</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.4. Methods of `Zend\Http\PhpEnvironment\Response` class.</div><table>
<thead>
<tr>
<th> Method Name                            </th>
<th> Description                                            </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>fromString($string)</code>                  </td>
<td>  Populate response object from string.                 </td>
</tr>
<tr>
<td> <code>getCookie()</code>                          </td>
<td> Retrieves Cookie header.                              </td>
</tr>
<tr>
<td> <code>setStatusCode($code)</code>                 </td>
<td> Sets HTTP status code and (optionally) message.        </td>
</tr>
<tr>
<td> <code>getStatusCode()</code>                      </td>
<td> Retrieves HTTP status code.                            </td>
</tr>
<tr>
<td> <code>setReasonPhrase($reasonPhrase)</code>       </td>
<td> Sets the HTTP status message.                         </td>
</tr>
<tr>
<td> <code>getReasonPhrase()</code>                    </td>
<td> Gets HTTP status message.                              </td>
</tr>
<tr>
<td> <code>getBody()</code>                            </td>
<td> Gets the body of the response.                         </td>
</tr>
<tr>
<td> <code>isForbidden()</code>                        </td>
<td> Checks if the response code is 403 Forbidden.         </td>
</tr>
<tr>
<td> <code>isNotFound()</code>                         </td>
<td> Checks if the status code indicates the resource is not found (404 status code). </td>
</tr>
<tr>
<td> <code>isOk()</code>                               </td>
<td> Checks whether the response is successful.          </td>
</tr>
<tr>
<td> <code>isServerError()</code>                      </td>
<td> Checks if the response is 5xx status code.           </td>
</tr>
<tr>
<td> <code>isRedirect()</code>                         </td>
<td> Checks whether the response is 303 Redirect.         </td>
</tr>
<tr>
<td> <code>isSuccess()</code>                          </td>
<td> Checks whether the response is 200 Successful.      </td>
</tr>
<tr>
<td> <code>renderStatusLine()</code>                   </td>
<td> Renders the status line header.                        </td>
</tr>
<tr>
<td> <code>toString()</code>                           </td>
<td> Renders entire response as HTTP response string.       </td>
</tr>
</tbody>
</table>
</div>
<h2 id="header-76">4.4. Variable Containers</h2>
<p>After you have retrieved the data from the HTTP request, you would do something with that data (typically you will 
process the data with your model layer) and return the data from the action method. </p>
<p>You can see that the <code>indexAction()</code> method of the Index controller returns an instance of the <code>ViewModel</code> class.
The <code>ViewModel</code> class is some kind of a <em>variable container</em>. All variables passed to 
its constructor, will be then automatically accessible by the view script.</p>
<p>Let's have some real-life example. We will create another action method in our <code>IndexController</code> class, which we 
will call the <code>aboutAction()</code>. The "about" action will display the <em>About</em> page of our site.
In the action method, we will create two variables containing information about our website,
and return the variables for rendering in a view with the help of <code>ViewModel</code> object:</p>
<pre class="line-numbers"><code class="language-php">// The "about" action
public function aboutAction() 
{              
    $appName = 'HelloWorld';
    $appDescription = 'A sample application for the Using Zend Framework 3 book';
    
    // Return variables to view script with the help of
    // ViewObject variable container
    return new ViewModel([
        'appName' =&gt; $appName,
        'appDescription' =&gt; $appDescription
    ]);
}
</code></pre>
<p>In lines 4-5, we create the <code>$appName</code> and <code>appDescription</code> variables. They store our application
name and description, respectively.</p>
<p>In lines 9-12, we pass the variables we've created to the constructor of the <code>ViewModel</code> object 
as an associative array. The array keys define the names of the variables which on return
will be accessible to view script.</p>
<p>The <code>ViewModel</code> class provides several methods that you can additionally use to 
set variables to <code>ViewModel</code> and and retrieve variables from it. The table 4.5 
provides the methods summary:</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.5. Methods of the ViewModel class</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>getVariable($name, $default)</code>                                  </td>
<td>  Returns a variable by name (or default value if the variable    does not exist).                                              </td>
</tr>
<tr>
<td> <code>setVariable($name, $value)</code>   </td>
<td> Sets a variable.                                              </td>
</tr>
<tr>
<td> <code>setVariables($variables, $overwrite)</code>                                 </td>
<td>  Sets a group of variables, optionally overwriting the   existing ones.                                                </td>
</tr>
<tr>
<td> <code>getVariables()</code>               </td>
<td> Returns all variables as an array.                            </td>
</tr>
<tr>
<td> <code>clearVariables()</code>             </td>
<td> Removes all variables.                                        </td>
</tr>
</tbody>
</table>
</div>
<h2 id="header-77">4.5. Controller Registration</h2>
<p>All controller classes belonging to a module should be registered in the <em>module.config.php</em> 
configuration file as follows:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
return [
  // ...
    
  'controllers' =&gt; [
    'factories' =&gt; [
      Controller\IndexController::class =&gt; InvokableFactory::class
      // Put other controllers registration here
    ],
  ],
    
  // ...
];
</code></pre>
<p>In line 5, we have the the <em>controllers</em> key, which contains the <em>factories</em> subkey. 
You should register your controllers here. To register a controller class, you
add the line in form of <em>key=&gt;value</em> pair. The key should be the fully qualified name of the controller class,
like <code>\Application\Controller\IndexController</code> (we can use the PHP <code>::class</code> keyword for class name resolution), 
and value should be the name of a factory class that would create the controller class for use. In our case,
we use the standard <code>InvokableFactory</code>, but you can create your own if you need.</p>
<blockquote class="notquote information" data-type="information"><p> By using the <code>InvokableFactory</code>, you tell Zend Framework
 that it can invoke the controller by instantiating it with the <code>new</code> operator. This is the most
 simple way of instantiating the controller. As an alternative, you can register your own factory
 to create the controller instance, and inject dependencies into controller (we will see how to do that later). </p>
</blockquote><h2 id="header-78">4.6. When to Create a New Controller?</h2>
<p>When your site grows in size, you should create new controller classes instead of putting
all actions to <code>IndexController</code>. The Index controller is used for defining the actions 
which work for your entire site. 
It is recommended to create new controller class for each model (or for most important ones) of your business logic domain. </p>
<p>For example, you can create <code>UserController</code> to manage users of your site.
This controller would have the default "index" action for displaying the page
with all users, "add" action for adding a new user, "edit" action for editing
user's profile and "delete" action for deleting the user.</p>
<p>By analogy, you would create <code>PurchaseController</code> and its actions to manage the purchases of your products 
and implementing the shopping cart, <code>DownloadController</code> and its actions to manage file downloads for the site, 
etc.</p>
<h2 id="header-79">4.7. Controller Plugins</h2>
<p>A <em>controller plugin</em> is a class which extends the functionality of <em>all controllers</em> in some way.</p>
<blockquote class="notquote information" data-type="information"><p> Without plugins, to extend the functionality of all controllers, you would have to 
 create a custom base class, say <code>BaseController</code>, and
 derive other controllers from that base class. This way can also be used, but from ZF3 creators' point of view, plugins are better
 solution, because they use <em>class composition</em> <sup id="fnref:foo"><a href="#fn:foo" class="footnote-ref" rel="footnote">2</a></sup>, which provides better flexibility comparing
 to class inheritance. You register your plugin controller and it automatically becomes 
 accessible from all controllers of your app (<code>AbstactActionController</code> base class uses PHP's <code>__call()</code> 
 magic method to proxy calls to registered controller plugins).</p>
</blockquote><footnotes id="fn:foo"><p><sup>2)</sup> <em>Composition</em> is a relationship between two classes that is best described as a "has-a" and 
"whole/part" relationship. The owner class contains a reference to another class (plugin). 
The owner is responsible for the lifetime of the object it holds.</p>
</footnotes>
<p>There are several standard controller plugins available out of the box (table 4.6), and we've already used one of 
them (the <code>Params</code> plugin) in one of our previous examples.</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.6. Standard Controller Plugins</div><table>
<thead>
<tr>
<th> <em>Standard Plugin Class</em>                  </th>
<th> <em>Description</em>                                        </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>Params</code>                                                                            </td>
<td>  Allows to retrieve variables from HTTP request,        including GET and POST variables.                    </td>
</tr>
<tr>
<td> <code>Url</code>                                                                               </td>
<td> Allows to generate absolute or relative URLs           from inside controllers.                             </td>
</tr>
<tr>
<td> <code>Layout</code>                                                                            </td>
<td> Gives access to layout view model for passing data to  layout template.                                     </td>
</tr>
<tr>
<td> <code>Identity</code>                                                                          </td>
<td> Returns the identity of the user who has logged into the   web site.                                            </td>
</tr>
<tr>
<td> <code>FlashMessenger</code>                                                                    </td>
<td> Allows to define "flash" messages which are stored in  session and can be displayed on a different web page.</td>
</tr>
<tr>
<td> <code>Redirect</code>                                                                          </td>
<td> Allows to redirect the request to another controller's   action method.                                       </td>
</tr>
<tr>
<td> <code>PostRedirectGet</code>                                                                   </td>
<td> Redirects the POST request, converting all POST variables   to GET ones.                                         </td>
</tr>
<tr>
<td> <code>FilePostRedirectGet</code>                    </td>
<td> Redirects the POST request, preserving uploaded files.</td>
</tr>
</tbody>
</table>
</div>
<p>Inside of the controller's action method, you access a plugin in the following way:</p>
<pre class="line-numbers"><code class="language-php">// Access Url plugin
$urlPlguin = $this-&gt;url();

// Access Layout plugin
$layoutPlugin = $this-&gt;layout();

// Access Redirect plugin
$redirectPlugin = $this-&gt;redirect();
</code></pre>
<h3 id="header-80">4.7.1. Writing Own Controller Plugin</h3>
<p>In your websites, you will definitely need to create custom controller plugins.
For example, assume you need that all your controller classes to be able to check
whether a site user is allowed to access certain controller action. This can be 
implemented with the <code>AccessPlugin</code> class. </p>
<p>The controller plugin should be derived from the <code>AbstractPlugin</code> class.
Plugins typically live in their own namespace <code>Plugin</code>, which is nested in 
<code>Controller</code> namespace:</p>
<pre class=""><code class="language-php">&lt;?php
namespace Application\Controller\Plugin; 

use Zend\Mvc\Controller\Plugin\AbstractPlugin;

// Plugin class
class AccessPlugin extends AbstractPlugin 
{
  // This method checks whether user is allowed
  // to visit the page 
  public function checkAccess($actionName)
  {
    // ...
  }
}
</code></pre>
<p>To let Zend Framework 3 know about your plugin, you need to register 
it in your <em>module.config.php</em> file under the <code>controller_plugins</code> key.
See below for example:</p>
<pre class=""><code class="language-php">&lt;?php
return [
  // ... 
 
  'controller_plugins' =&gt; [
    'factories' =&gt; [
      Controller\Plugin\AccessPlugin::class =&gt; InvokableFactory::class,
    ],
	'aliases' =&gt; [
		'access' =&gt; Controller\Plugin\AccessPlugin::class,
	]
  ],
 
  // ...
];
</code></pre>
<blockquote class="notquote information" data-type="information"><p> Please note that we also register an alias for the plugin to be able to get
 the plugin by its short name.</p>
</blockquote><p>After that, you'll be able to access your custom plugin from
all of your controller's actions in this way:</p>
<pre class=""><code class="language-php">// Check if site user is allowed to visit the "index" page
$isAllowed = $this-&gt;access()-&gt;checkAccess('index');
</code></pre>
<h2 id="header-81">4.8. Views</h2>
<p>Views belong to the presentation layer of the web application, because their goal
is to produce HTML output returned by the web server to site visitors. </p>
<p>In Zend Framework 3, you implement a view as a <em>template file</em>, which is a file 
having <code>.phtml</code> extension ("phtml" stands for PHP+HTML). View templates have such 
a name because they usually contain HTML code mixed with PHP code snippets used 
for rendering the web pages. </p>
<p>Views typically live inside of the <em>view</em> subdirectory
of the module (see figure 4.5):</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/views_dir.png">
<img src="images/mvc/views_dir.png" alt="Figure 4.5. View directory" /></a>
<span class="image-caption">Figure 4.5. View directory</span>
</span>
</p>
<blockquote class="notquote question" data-type="question"><p> <strong>Why are view template files not stored under module's source directory?</strong></p>
<p> View templates (<code>.phtml</code> files) are not stored under module's <code>src/</code> directory,
 because they are not usual PHP classes and do not need to be resolved by a PHP
 class autoloading feature. View templates are resolved by the special ZF3 class
 called <em>view resolver</em>, and for this reason, view templates are stored under
 the module's <code>view</code> directory.</p>
</blockquote><p>View templates can have different behaviors, based on variables you pass to them from the controller's
action method. Data is passed to view templates with the help of a <code>ViewModel</code> variable container.</p>
<p>For example, let's implement the view template for the <code>aboutAction()</code> of our Index controller.
The <em>About</em> page will display the title and some information about our Hello World application. </p>
<p>To create the view template file, in your NetBeans window, navigate to <em>view/application/index</em> directory (see figure 4.6), 
and right click on the "index" directory name. From the context menu that appears,
select the <em>New-&gt;PHP File...</em> menu item. </p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/new_php_file.png">
<img src="images/mvc/new_php_file.png" alt="Figure 4.6. Context Menu" /></a>
<span class="image-caption">Figure 4.6. Context Menu</span>
</span>
</p>
<p>In the "New PHP File" dialog that appears (figure 4.7), enter the name <em>about.phtml</em> and click the <em>Finish</em> button.</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/new_php_file_dialog.png">
<img src="images/mvc/new_php_file_dialog.png" alt="Figure 4.7. Context Menu" /></a>
<span class="image-caption">Figure 4.7. Context Menu</span>
</span>
</p>
<p>The <em>about.phtml</em> view template file will be created and displayed in the right pane of NetBeans window.
In that file, enter the following: </p>
<pre class="line-numbers"><code class="language-php">&lt;h1&gt;About&lt;/h1&gt;

&lt;p&gt;
    The Hello World application.
&lt;/p&gt;

&lt;p&gt;
    Application name: &lt;?= $this-&gt;escapeHtml($appName); ?&gt;
&lt;/p&gt;

&lt;p&gt;
    Application description: &lt;?= $this-&gt;escapeHtml($appDescription); ?&gt;.
&lt;/p&gt;
</code></pre>
<p>As you can see, the view template is a usual HTML page with several PHP code fragments.
A view script just renders the data you pass to it with a <code>ViewModel</code> variable container.
For example, in line 8 we get the value of <code>$appName</code> variable and print it into the standard output stream. 
Please note that we are using <code>escapeHtml</code> view helper to <em>escape</em> the string printed to the web page
to make the website resistant to hacker attacks.</p>
<blockquote class="notquote warning" data-type="warning"><p> You should always escape variables that you print to your web page. Escaping allows to be sure that no malicious code
 is injected on your page.</p>
</blockquote><blockquote class="notquote information" data-type="information"><p> In your view script, you can also use simple flow control operations (like <code>if</code>, <code>foreach</code> or <code>switch</code>) to 
make the appearance of the page different depending on variable's value. </p>
</blockquote><p>Now let's look at how the page looks like in the web browser. Type "http://localhost/application/about"
URL in your browser's navigation bar. The About page should appear (see figure 4.8):</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/about_page.png">
<img src="images/mvc/about_page.png" alt="Figure 4.8. About Page" /></a>
<span class="image-caption">Figure 4.8. About Page</span>
</span>
</p>
<blockquote class="notquote tip" data-type="tip"><p> In general, the PHP code you use inside of views must be as simple as possible. 
 Views typically do not modify the data you pass from controller. 
 For example, a view can use the model you pass to it to walk through database table rows and render 
 the items to an HTML page, but it should never create database tables or modify them itself.</p>
</blockquote><h2 id="header-82">4.9. View Helpers</h2>
<p>A <em>view helper</em> is typically a (relatively) simple PHP class whose goal is to render some part of a view.
You can invoke view helpers from any view template. With view helpers, you can create reusable widgets
(like menus, navigation bars, etc.) for your web pages.</p>
<blockquote class="notquote information" data-type="information"><p> View helpers are analogous to controller plugins: the controller plugins allow to "extend"
 the functionality of controllers, and view helpers allow to "extend" the functionality of view
 templates.</p>
</blockquote><p>ZF3 provides many standard view helpers out of the box. In the table 4.7, some of them are
presented with a brief description:</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.7. Standard View Helpers</div><table>
<thead>
<tr>
<th> <em>Standard Plugin Class</em>                  </th>
<th> <em>Description</em>                                        </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>BasePath</code>                                                                          </td>
<td>  Allows to retrieve the base path to the web application,   which is the absolute path to <code>APP_DIR</code>.             </td>
</tr>
<tr>
<td> <code>Url</code>                                                                               </td>
<td> Allows to generate absolute or relative URL addresses  from inside view templates.                          </td>
</tr>
<tr>
<td> <code>ServerUrl</code>                              </td>
<td> Retrieves the current request's URL.                 </td>
</tr>
<tr>
<td> <code>Doctype</code>                                                                           </td>
<td> Helper for setting and retrieving the doctype HTML element   of the web page.                                     </td>
</tr>
<tr>
<td> <code>PageTitle</code>                                                                         </td>
<td> Helper for setting the title HTML element              of the web page.                                     </td>
</tr>
<tr>
<td> <code>HtmlList</code>                               </td>
<td> Helper for generating ordered and unordered HTML lists. </td>
</tr>
<tr>
<td> <code>ViewModel</code>                              </td>
<td> Helper for storing and retrieving the view model     </td>
</tr>
<tr>
<td> <code>Layout</code>                                 </td>
<td> Retrieves the layout template view.                  </td>
</tr>
<tr>
<td> <code>Partial</code>                                </td>
<td> Allows to render a "partial" view template.          </td>
</tr>
<tr>
<td> <code>InlineScript</code>                                                                      </td>
<td> Helper for setting and retrieving script elements for  inclusion in HTML body section.                      </td>
</tr>
<tr>
<td> <code>Identity</code>                               </td>
<td> View helper to retrieve the authenticated user's identity. </td>
</tr>
<tr>
<td> <code>FlashMessenger</code>                                                                    </td>
<td> Allows to retrieve the "flash" messages stored in      session.                                             </td>
</tr>
<tr>
<td> <code>EscapeHtml</code>                             </td>
<td> Allows to escape a variable outputted to a web page. </td>
</tr>
</tbody>
</table>
</div>
<p>To demonstrate the usage of a view helper, below we will show how to set a title for a web page.
Typically, it is required to give a different title per each web page. You can do this
with the <code>HeadTitle</code> view helper. For example, you can set the title for the <em>About</em>
page by adding the following PHP code in the beginning of the <em>about.phtml</em> view template:</p>
<pre class=""><code class="language-php">&lt;?php
$this-&gt;headTitle('About');
?&gt;
</code></pre>
<p>In the code above, we call the <code>HeadTitle</code> view helper and pass it the page title string ("About") 
as the argument. The <code>HeadTitle</code> view helper internally sets the text for the <code>&lt;title&gt;</code> HTML
element of your web page. Then, if you open the <em>About</em> page in your web browser, 
the page title will look like "About - ZF Skeleton Application" (see the figure 4.9
below for an example):</p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/about_title.png">
<img src="images/mvc/about_title.png" alt="Figure 4.9. Setting page title for the About page" /></a>
<span class="image-caption">Figure 4.9. Setting page title for the About page</span>
</span>
</p>
<blockquote class="notquote information" data-type="information"><p> We will discuss the view helpers in more details and provide 
 more usage examples in the chapter <a href="Page_Appearance_and_Layout.html">Page Appearance and Layout</a>.</p>
</blockquote><h2 id="header-83">4.10. View Template Names</h2>
<p>When you return data with the <code>ViewModel</code> variable container from your controller's 
action method, Zend Framework somehow knows the name of the corresponding view template 
file. For example, for your <code>IndexController</code>'s <code>aboutAction()</code> method, 
ZF3 automatically uses the <em>about.phtml</em> view template.</p>
<blockquote class="notquote information" data-type="information"><p> ZF3 determines the correct view template name by module name, controller name and action name. 
 For example, <code>IndexController::aboutAction()</code> action belonging to <code>Application</code> module will
 have the <code>application/index/about.phtml</code> view template by default.</p>
</blockquote><h3 id="header-84">4.10.1. Overriding Default View Template Name</h3>
<p>The <code>ViewModel</code> can also be used to override the default view template resolving.
Actually the <code>ViewModel</code> class is more than just a variable container. Additionally, it 
allows to specify which view template should be used for page rendering. The summary
of methods provided for this purpose is shown in table 4.8.</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.8. Methods of the ViewModel class for setting and retrieving the view template name</div><table>
<thead>
<tr>
<th> <em>Method name</em>                  </th>
<th> <em>Description</em>                                                 </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>setTemplate()</code>                </td>
<td>  Sets the view template name.                                  </td>
</tr>
<tr>
<td> <code>getTemplate()</code>                </td>
<td> Returns the view template name.                               </td>
</tr>
</tbody>
</table>
</div>
<p>To set the view template name, you use the <code>setTemplate()</code> method. The <code>getTemplate()</code> method
returns the view template name currently set for the view model. </p>
<p>The following code example shows how you can call the <code>setTemplate()</code> 
method from your <code>IndexController</code> class' <code>indexAction()</code> method to 
force ZF3 to use the <em>about.phtml</em> view template file for rendering the <em>Home</em> 
page, instead of the <em>index.phtml</em> file:</p>
<pre class="line-numbers"><code class="language-php">// Index action renders the Home page of your site.
public function indexAction() 
{    
	// Use a different view template for rendering the page.
	$viewModel = new ViewModel();
	$viewModel-&gt;setTemplate('application/index/about');
	return $viewModel;
}
</code></pre>
<p>In the code above, we created a new instance of the <code>ViewModel</code> class as usual (line 5).</p>
<p>Then we called the <code>setTemplate()</code> method on the view model object (line 6) and
passed the name of the view template name as its argument. The view template name
is actually a relative path to the <code>about.phtml</code> file, minus file extension.</p>
<p>Finally, we returned the view model object from the action method (line 7).</p>
<blockquote class="notquote information" data-type="information"><p> However, calling the <code>setTemplate()</code> method in every action method is optional. 
If you don't do that, ZF3 will determine the view template name automatically 
by concatenating the current module name, controller name and action method name.</p>
</blockquote><h2 id="header-85">4.11. View Resolver</h2>
<p>When Zend Framework has the template name, it only remains to determine the absolute path
to the corresponding <em>.phtml</em> file. This is also called the <em>view template resolving</em>.
View templates are resolved with the special Zend Framework's class called the <em>view resolver</em>.</p>
<p>In ZF3, there are two view resolvers out of the box: <code>TemplatePathStack</code> and <code>TemplateMapResolver</code>.
Both resolvers take a view template name as input, and return path to view template file as output.
The template name is usually composed of module name followed by controller name followed by template name, like "application/index/about",
"application/index/index". An exception is "layout/layout", which doesn't belong to any module. </p>
<ul>
<li>The <em>template map resolver</em> uses a PHP nested array to determine path to view template file by its
name. This way is fast, but you have to maintain some template map array and update it each
time you add a new view script.</li>
<li>The <em>template path stack resolver</em> assumes that the view template name can be mapped 
to directory structure. For example, "index/about" template name maps to 
<em>APP_DIR/module/Application/view/application/index/about.phtml</em>.
This way is simpler, because you don't have to maintain any maps. </li>
</ul>
<p>View resolver settings are stored inside of your <em>module.php.config</em> file under the <em>view_manager</em> key:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
return [
  //...
    
  'view_manager' =&gt; [
    //...
        
    'template_map' =&gt; [
        'layout/layout'           =&gt; __DIR__ . '/../view/layout/layout.phtml',
        'application/index/index' =&gt; __DIR__ . '/../view/application/index/index.phtml',
        'error/404'               =&gt; __DIR__ . '/../view/error/404.phtml',
        'error/index'             =&gt; __DIR__ . '/../view/error/index.phtml',
    ],
    'template_path_stack' =&gt; [
      __DIR__ . '/../view',
    ],
  ],
];
</code></pre>
<p>You can see that template map resolver's settings are stored under the <em>template_map</em> key. By default,
there are several "standard" view templates, which are resolved this way: the index page template, the layout template
(we will talk about it in <a href="Page_Appearance_and_Layout.html">Page Appearance and Layout</a>) and error templates (we will talk about them
a little bit later). These standard pages are served with this type of resolver, because it is
fast.</p>
<p>The template path stack resolver's settings are stored under the <em>template_path_stack</em> key.
You can see that this resolver looks for your view scripts under the "view" directory of your module.
That's why we could just put <em>about.phtml</em> file under that directory, and ZF will automatically find the
template.</p>
<p>The template map resolver and template path stack resolver work in pair. First, the fast template map
resolver tries to find the template view in its array map, and if the page is not found,
the template path stack resolver is executed.</p>
<h2 id="header-86">4.12. Disabling the View Rendering</h2>
<p>Sometimes, you would need to disable the default view rendering.
To do that, just return the <code>Response</code> object from the the controller's action.</p>
<p>For example, let's create a <code>DownloadController</code> class, and add the "file" action, 
which would allow site users to download files from your website. This 
action does not need a corresponding <em>file.phtml</em> view template, because it just dumps file contents 
to PHP standard output stream.</p>
<p>Add the <em>DownloadController.php</em> file to <em>Controller</em> directory of <em>Application</em> module, then
put the following code into the file:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
namespace Application\Controller;

use Zend\Mvc\Controller\AbstractActionController;
use Zend\View\Model\ViewModel;

/**
 * This is the controller class for managing file downloads.
 */
class DownloadController extends AbstractActionController 
{
  /**
   * This is the 'file' action that is invoked
   * when a user wants to download the given file.     
   */
  public function fileAction() 
  {
    // Get the file name from GET variable
    $fileName = $this-&gt;params()-&gt;fromQuery('name', '');
	
    // Take some precautions to make file name secure
    str_replace("/", "", $fileName);  // Remove slashes
    str_replace("\\", "", $fileName); // Remove back-slashes
	
    // Try to open file
    $path = './data/download/' . $fileName;
    if (!is_readable($path)) {
      // Set 404 Not Found status code
      $this-&gt;getResponse()-&gt;setStatusCode(404);            
      return;
    }
		
    // Get file size in bytes
    $fileSize = filesize($path);

    // Write HTTP headers
    $response = $this-&gt;getResponse();
    $headers = $response-&gt;getHeaders();
    $headers-&gt;addHeaderLine(
                 "Content-type: application/octet-stream");
    $headers-&gt;addHeaderLine(
                 "Content-Disposition: attachment; filename=\"" . 
			     $fileName . "\"");
    $headers-&gt;addHeaderLine("Content-length: $fileSize");
    $headers-&gt;addHeaderLine("Cache-control: private"); 
		
    // Write file content        
    $fileContent = file_get_contents($path);
    if($fileContent!=false) {                
      $response-&gt;setContent($fileContent);
    } else {        
      // Set 500 Server Error status code
      $this-&gt;getResponse()-&gt;setStatusCode(500);
      return;
    }
	
    // Return Response to avoid default view rendering
    return $this-&gt;getResponse();
  }
}
</code></pre>
<p>The action method takes the <em>name</em> parameter from URL's query part (line 19),
removes slashes from file name (lines 22-23), adds HTTP headers to <code>Response</code> object 
(lines 39-45) and file contents (lines 48-55). Finally, it returns the <code>Response</code> object
to disable the default view rendering.</p>
<p>Register the <code>DownloadController</code> class by adding the following line to
your <em>module.config.php</em> file:</p>
<pre class=""><code class="language-php">&lt;?php
return [
  // ...    
  'controllers' =&gt; [
    'factories' =&gt; [
      // ...
      Controller\DownloadController::class =&gt; InvokableFactory::class
    ],
  ],    
  // ...
];
</code></pre>
<p>You will also need to add a <em>route</em> to your <em>module.config.php</em> (a route tells ZF3 to what URL to map the
controller action). Modify the <code>routes</code> key of the config file as follows:</p>
<pre class=""><code class="language-php">&lt;?php
return [
  // ...    
  'router' =&gt; [
        'routes' =&gt; [
            // Add this route for the DownloadController
            'download' =&gt; [
                'type'    =&gt; Segment::class,
                'options' =&gt; [
                    'route'    =&gt; '/download[/:action]',
                    'defaults' =&gt; [
                        'controller'    =&gt; Controller\DownloadController::class,
                        'action'        =&gt; 'index',
                    ],
                ],
            ],
        ],
    ], 
  // ...
];
</code></pre>
<p>To see how the file download works, create <em>APP_DIR/data/download</em> directory
and put some text file named <em>sample.txt</em> in it. Then open your web browser and type the URL 
"http://localhost/download/file?name=sample.txt" in 
your browser's navigation bar and press the Enter key. The browser will download 
the <em>sample.txt</em> file and offer you to save it to some location.</p>
<h2 id="header-87">4.13. Error Pages</h2>
<p>When a page could not be found or some other error happens inside of your web application,
a standard error page is displayed. The appearance of the error page is controlled by the
error templates. There are two error templates: <em>error/404</em> which is used for "404 Page Not Found"
error (shown in figure 4.10), and <em>error/index</em> which is displayed when a generic error occurs (such as an unhandled exception is thrown somewhere
inside of the application). </p>
<p><span class="image-wrapper">
<a target="_blank" href="images/mvc/error_404.png">
<img src="images/mvc/error_404.png" alt="Figure 4.10. 404 Error Page" /></a>
<span class="image-caption">Figure 4.10. 404 Error Page</span>
</span>
</p>
<p>The <em>module.config.php</em> file contains several parameters under the <em>view_manager</em> key, which you can use 
to configure the appearance of your error templates:</p>
<pre class="line-numbers"><code class="language-php">&lt;?php
return [
  //...
    
  'view_manager' =&gt; [    
    'display_not_found_reason' =&gt; true,
    'display_exceptions'       =&gt; true,
    //...
    'not_found_template'       =&gt; 'error/404',
    'exception_template'       =&gt; 'error/index',    
    'template_map' =&gt; [
      //...
      'error/404' =&gt; __DIR__ . '/../view/error/404.phtml',
      'error/index'=&gt; __DIR__ . '/../view/error/index.phtml',
    ],
    //...
  ],
];
</code></pre>
<ul>
<li>The <em>display_not_found_reason</em> parameter controls whether to display the detailed
information about the "Page not Found" error.</li>
<li>The <em>display_exceptions</em> parameter defines whether to display information about
an unhandled exception and its stack trace.</li>
<li>The <em>not_found_template</em> defines the template name for the 404 error.</li>
<li>The <em>exception_template</em> specifies the template name for the unhandled exception error.</li>
</ul>
<blockquote class="notquote tip" data-type="tip"><p> You typically set the <em>display_not_found_reason</em> and <em>display_exceptions</em> parameters
 to <code>false</code> in production systems, because you don't want site visitors see the details
 about errors in your site. However, you will still be able to retrieve the detailed
 information from Apache's <code>error.log</code> file.</p>
</blockquote><h2 id="header-88">4.14. Models</h2>
<p>A <em>model</em> is a PHP class which contains the business logic of your application. 
The business logic is the "core" of your website. It implements the goal of site
operation. For example, if you implement an E-shop website, you will have models
implementing the product catalog and the shopping cart.</p>
<p>In general, the term model means a simplified representation of a real-life object
or phenomenon. Simplified because the real-life object has infinite amount 
of properties. For example, a real-life person who visits your site consists of billions of atoms, 
and you cannot describe them all. Instead, you take several properties of the object, 
which are the most important for your system and ignore all others.
For example, the most important properties of the site visitor (from website architect's point of view) are 
first name, last name, country, city, post code and street address. </p>
<p>Models can have some behavior. For example, a mailer model 
may send E-mail messages, the currency converter model may 
be able to convert money and so on. </p>
<blockquote class="notquote information" data-type="information"><p> With ZF3, you represent models as usual PHP classes. 
Properties are implemented as class fields, and
the behaviors are implemented as class methods. </p>
</blockquote><h2 id="header-89">4.15. Model Types</h2>
<p>In Zend Framework 3, there is no single <code>Model</code> directory for storing the model classes, as you could
assume. Instead, by convention, models are further subdivided into the following principal types, and each type is
stored in its own subdirectory (see table 4.9):</p>
<div class="table-wrapper">
<div class="table-caption">Table 4.9. Model Types and their Location</div><table>
<thead>
<tr>
<th> <em>Model Type</em>                   </th>
<th> <em>Directory</em>                                              </th>
</tr>
</thead>
<tbody>
<tr>
<td>  Entities                       </td>
<td>  <code>APP_DIR/module/Application/src/Entity</code>                  </td>
</tr>
<tr>
<td> Value Objects                  </td>
<td> <code>APP_DIR/module/Application/src/ValueObject</code>             </td>
</tr>
<tr>
<td> Services                       </td>
<td> <code>APP_DIR/module/Application/src/Service</code>                 </td>
</tr>
<tr>
<td> Repositories                   </td>
<td> <code>APP_DIR/module/Application/src/Repository</code>              </td>
</tr>
<tr>
<td> Factories                                                       </td>
<td> In <code>Factory</code> subdirectory under each model type directory.  For example, controller factories would be stored in <code>APP_DIR/module/Application/src/Controller/Factory</code>     </td>
</tr>
</tbody>
</table>
</div>
<blockquote class="notquote information" data-type="information"><p> Separation of models into different types make it easier to design your business logic domain.
 This is also called the "Domain Driven Design" (or shortly, DDD). The person who proposed DDD was Eric Evans
 in his famous book called <em>Domain-Driven Design â Tackling Complexity in the Heart of Software</em>.</p>
</blockquote><p>Below, we will describe the principal model types further.</p>
<h3 id="header-90">4.15.1. Entities</h3>
<p><em>Entities</em> always have some <em>identifier</em> property, so you can uniquely identify the object. 
For example, a <code>User</code> entity always has a unique <code>login</code> property,
and you can identify the user by that attribute. You can change some other attributes
of the entity, like <code>firstName</code>, or <code>address</code>, but its identifier never changes.
Entity models are usually stored in a database, in a file system or in any other storage.</p>
<p>Below, you can find an example a <code>User</code> entity, which represents a site visitor:</p>
<pre class="line-numbers"><code class="language-php">// The User entity represents a site visitor
class User 
{
  // Properties
  private $login;     // e.g. "admin"
  private $title;     // e.g. "Mr."
  private $firstName; // e.g. "John"
  private $lastName;  // e.g. "Doe"
  private $country;   // e.g. "USA"
  private $city;      // e.g. "Paris"
  private $postCode;  // e.g. "10543"
  private $address;   // e.g. "Jackson rd."
    
  // Behaviors    
  public getLogin() 
  {
    return $this-&gt;login;
  }
        
  public setLogin($login) 
  {
    $this-&gt;login = $login;
  }
    
  //...
}
</code></pre>
<p>In lines 5-12, we define <code>User</code> model's properties. The best practice is to 
define the properties using the private access type, and make
them available to the caller through <em>getter</em> and <em>setter</em> public methods 
(like <code>getLogin()</code> and <code>setLogin()</code>, etc). </p>
<blockquote class="notquote information" data-type="information"><p> Model's behavior methods are not limited by getters and setters.
 You can create other methods which manipulate model's data.
 For example, you can define the <code>getFullName()</code> convenience method,
 which would return the user's full name, like "Mr. John Doe".</p>
</blockquote><h3 id="header-91">4.15.2. Value Objects</h3>
<p><em>Value objects</em> are a kind of model for which the identity is not as important as for entities.
A value object is usually a small class identified by all of its attributes. 
It does not have an identifier attribute. Value objects typically have getter methods, but do not 
have setters (value objects are immutable). </p>
<p>For example, a model wrapping a money amount can be 
treated as a value object:</p>
<pre class="line-numbers"><code class="language-php">class MoneyAmount 
{
  // Properties
  private $currency;
  private $amount;
  
  // Constructor
  public function __construct($amount, $currency='USD') 
  {
    $this-&gt;amount = $amount;
    $this-&gt;currency = $currency;
  }
  
  // Gets the currency code  
  public function getCurrency() 
  {
    return $this-&gt;currency;  
  }
  
  // Gets the money amount
  public function getAmount() 
  {
    return $this-&gt;amount;
  }  
}
</code></pre>
<p>In lines 4-5 we define two properties: <code>currency</code> and <code>amount</code>. The model
has no identifier property, instead it is identified by all properties as
a whole: if you change either the <code>currency</code> or <code>amount</code>, you would have a 
different money amount object.</p>
<p>In lines 8-12 we define the constructor method, which initializes the properties.</p>
<p>In lines 15-24, we define getter methods for model's properties. Note that we
do not have setter methods (the model is immutable).</p>
<h3 id="header-92">4.15.3. Services</h3>
<p><em>Service models</em> usually encapsulate some business logic functionality. 
Services usually have easily recognizable names ending with "er" suffix, like <code>FileUploader</code> or <code>UserManager</code>. </p>
<p>Below, an example of <code>Mailer</code> service is presented. It has the <code>sendMail()</code>
method which takes an <code>EmailMessage</code> value object and sends an E-mail message
using standard PHP <code>mail()</code> function:</p>
<pre class=""><code class="language-php">&lt;?php

// The Email message value object
class EmailMessage 
{  
  private $recipient;
  private $subject;
  private $text;  
  
  // Constructor
  public function __construct($recipient, $subject, $text) 
  {
    $this-&gt;recipient = $recipient;
    $this-&gt;subject = $subject;
    $this-&gt;text = $text;
  }
  
  // Getters
  public function getRecipient() 
  {
    return $this-&gt;recipient;
  }
  
  public function getSubject() 
  {
    return $this-&gt;subject;
  }
  
  public function getText() 
  {
    return $this-&gt;text;
  }
}

// The Mailer service, which can send messages by E-mail
class Mailer 
{
  
  public function sendMail($message) 
  {
    // Use PHP mail() function to send an E-mail
    if(!mail($message-&gt;getRecipient(), $message-&gt;getSubject(), 
             $message()-&gt;getText())) 
    {
      // Error sending message
      return false
    }
    
    return true;
  }
}
</code></pre>
<blockquote class="notquote tip" data-type="tip"><p> In Zend Framework, you typically register your service models in Service Manager.</p>
</blockquote><h3 id="header-93">4.15.4. Factories</h3>
<p><em>Factories</em> are usually being designed to instantiate other models. In the simplest cases you 
can create an instance of a class without any factory, just by using the <code>new</code> operator, but 
sometimes class creation logic might be very complex, and you encapsulate it inside of a factory class. 
Factory classes typically have names ending with <code>Factory</code> suffix, like 
<code>IndexControllerFactory</code>, <code>MailerFactory</code>, etc.</p>
<p>For example, let's consider the case when you use a CAPTCHA image in a web form. The image
is a type of challenge-response test used to determine whether the user is a human or a robot.
There may be different CAPTCHA types: simple image captcha, <a href="http://www.google.com/recaptcha">reCAPTCHA</a> and so on.
Let's create a fictitious <code>CaptchaFactory</code> class, whose only goal is to
create different CAPTCHA images based on the <code>type</code> argument you pass to its <code>createCaptcha()</code>
method. </p>
<pre class=""><code class="language-php">use Zend\ServiceManager\Factory\FactoryInterface;

// The CaptchaFactory class is used to create CAPTCHA
// image for a web form.
class CaptchaFactory extends FactoryInterface
{
  // Creates a CAPTCHA object based on type parameter
  public function __invoke(ContainerInterface $container, $requestedName, array $options) 
  {
    $type = $options['type'];
    if($type=='Image')
      return new ImageCaptcha();
    else if($type=='ReCaptcha')
      return new ReCaptcha();
    else
      throw new Exception('Unknown captcha type');
  }
}
</code></pre>
<h3 id="header-94">4.15.5. Repositories</h3>
<p><em>Repositories</em> are specific models responsible for storing and retrieving entities.
For example, a <code>UserRepository</code> may represent a database table and provide methods
for retrieving <code>User</code> entities. You typically use repositories when storing entities
in a database. With repositories, you can encapsulate SQL query logic in the
single place and easily maintain and test it.</p>
<blockquote class="notquote information" data-type="information"><p> We will learn about repositories in more details in <a href="#doctrine">Database Management with Doctrine</a>, when
 talking about Doctrine library.</p>
</blockquote><h2 id="header-95">4.16. Determining the Correct Model Type</h2>
<blockquote class="notquote question" data-type="question"><p> <strong>Isn't it confusing to have so many model types?</strong></p>
<p> Well, yes and no. At first, it may be a little difficult to determine
 the correct model type, but as soon you improve your
 skills, you will be able to do that intuitively. Just remember that model types improve the
 structure of your domain models. </p>
</blockquote><p>When writing your own application having specific model domain, you may be confused
when trying to decide to which model type your class belongs (whether it is an entity,
value object, repository, service or factory). Below, a simple algorithm
is provided to make it easier for you to determine the correct model type
when writing your own application:</p>
<ul>
<li>Your model class is definitely a <em>Service</em><ul>
<li>if it encapsulates some business logic</li>
<li>if you call it from your controller class</li>
<li>if you think the best name for it ends with "er": suffix, like <code>FileUploader</code> or <code>VersionChecker</code></li>
</ul>
</li>
<li>Your model class is an <em>Entity</em>:<ul>
<li>if your model is stored in a database</li>
<li>if it has an ID attribute</li>
<li>if it has both getters and setters methods</li>
</ul>
</li>
<li>Your model class is a <em>ValueObject</em>:<ul>
<li>if changing any attribute would make the model completely different</li>
<li>if your model has getters, but not setters (immutable)</li>
</ul>
</li>
<li>Your model is a <em>Repository</em>:<ul>
<li>if it works with a database to retrieve entities    </li>
</ul>
</li>
<li>Your model is a <em>Factory</em>:<ul>
<li>if it can create other objects and can do nothing else</li>
</ul>
</li>
</ul>
<blockquote class="notquote question" data-type="question"><p> <strong>Hmm... what if I just store all my models in a single Model directory?</strong></p>
<p> Of course, you can, if you strongly wish. But, when you use Doctrine ORM
 library, you will notice that it utilizes DDD principles as well, so using DDD
 makes your application well-organized.</p>
</blockquote><h2 id="header-96">4.17. Other Model Types</h2>
<p>In your website, you will typically divide your principal model types (described above) into subtypes.
For example, you will have:</p>
<ul>
<li><p><em>Forms</em>. Forms are models whose purpose is to collect data entered by web user. Forms are a subtype of
<em>entities</em>. You will typically store forms in <code>APP_DIR/module/Application/src/Form</code> directory.</p>
</li>
<li><p><em>Filters</em>. Filters are designed for transforming input data. Filters are a subtype of <em>services</em>. 
You will typically store filters in <code>APP_DIR/module/Application/src/Filter</code> directory.</p>
</li>
<li><p><em>Validators</em>. Validators are used for checking input data for correctness. Validators are also a subtype of <em>services</em>. 
You will typically store validators in <code>APP_DIR/module/Application/src/Validator</code> directory.</p>
</li>
<li><p><em>View Helpers</em>. They encapsulate some page rendering functionality. View helpers are similar to <em>services</em>.
You will typically store view helpers in <code>APP_DIR/module/Application/src/View/Helper</code> directory.</p>
</li>
<li><p><em>Routes</em>. Routes are a specific <em>service</em> model used for implementing custom mapping rules between URLs and your
controllers. You will typically store custom routes in <code>APP_DIR/module/Application/src/Route</code> directory.</p>
</li>
</ul>
<p>So, eventually you will have the following typical directory structure of your website's module:</p>
<pre class=""><code class="language-text">/Application/src
	/Controller
		/Plugin
		/Factory
	/Entity
	/Filter
	/Form
	/Route
	/Service
		/Factory
	/Validator
	/View
		/Helper
</code></pre>
<blockquote class="notquote information" data-type="information"><p> It is possible to have arbitrarily many model subtypes. The more complex is your application, the more model subtypes
 you may have. </p>
</blockquote><h2 id="header-97">4.18. Skinny Controllers, Fat Models, Simple Views</h2>
<p>When developing a website using Model-View-Controller pattern, there is a risk
of misunderstanding the role of controllers, views and models. This results in making the
controllers huge and models small, which in turn makes it difficult to test and support 
your application. This section's goal is to give you a general understanding of what 
code may be placed in a controller class, what code may be placed in a view template, 
and what code may be placed in a model class.</p>
<h3 id="header-98">4.18.1. Skinny Controllers</h3>
<p>The idea behind the term "skinny controller" is that typically, in your controller classes, 
you put only the code that:</p>
<ul>
<li>accesses user request data (<code>$_GET</code>, <code>$_POST</code>, <code>$_FILES</code> and other PHP variables);</li>
<li>checks the validity of the input data;</li>
<li>(optionally) makes some basic preparations to the data;</li>
<li>passes the data to model(s) and retrieves the result returned by the model(s);</li>
<li>and finally returns the output data as a part of a <code>ViewModel</code> variable container.</li>
</ul>
<p>A controller class should avoid:</p>
<ul>
<li>containing complex business logic, which is better kept in model classes;</li>
<li>containing any HTML or any other presentational markup code. This is better 
be put in view templates.</li>
</ul>
<p>For an example of a "skinny" controller, look at the <code>CurrencyConverterController</code> 
class below. This controller provides the "convert" action method whose goal is to convert 
an amount of money from EUR to USD currency. The user passes the amount of money through the
"amount" GET variable.</p>
<pre class="line-numbers"><code class="language-php">class CurrencyConverterController extends AbstractActionController 
{  
  // Currency converter model
  private $currencyConverter;

  // Constructor. It's purpose is to "inject" dependencies.
  public function __construct($currencyConverter)
  {
    $this-&gt;currencyConverter = $currencyConverter;
  }

  // The "convert" action displays the converted money amount
  public function convertAction() 
  {  
    // Get the money amount from GET
    $amount = (float)$this-&gt;params()-&gt;fromQuery('amount', -1);
    
    // Validate input data
    if($amount&lt;0) {
      // Money amount is missing
      $this-&gt;getResponse()-&gt;setStatusCode(404);
      return;
    }
 
    // Pass the data to the CurrencyConverter model
    $convertedAmount = $this-&gt;currencyConverter-&gt;convertEURtoUSD($amount);	
		
    return new ViewModel([
      'amount'=&gt;$amount,
      'convertedAmount'=&gt;$convertedAmount
    ]);
  }
}
</code></pre>
<p>The controller's action method above does the following:</p>
<ul>
<li><p>Takes the data passed by site user (line 16). This data is usually part of 
 <code>Request</code> object and can be retrieved using the controller's <code>getRequest()</code> method 
or <code>Params</code> controller plugin.</p>
</li>
<li><p>Performs the basic check on the data passed by user (line 19), and if the data is missing (or invalid),
sets an HTTP error code (line 21). </p>
</li>
<li><p>Passes the money amount to the <code>CurrencyConverter</code> model (line 26) by calling its <code>convertEURtoUSD()</code> method. The method
then returns the converted amount.</p>
</li>
<li><p>Constructs the <code>ViewModel</code> variable container and passes the resulting
data to it (line 28). This variable container can be further accessed in the corresponding 
view template responsible for data presentation.</p>
</li>
</ul>
<h3 id="header-99">4.18.2. Fat Models</h3>
<p>Because you need to keep your controllers as thin as possible, 
most of the business logic of your application should be put into 
model classes. In a  properly designed Model-View-Controller application, 
models look "huge". A model class may contain the code which:</p>
<ul>
<li><p>Performs complex data filtering and validation. Because the data that you retrieved
in controller is passed to
your application from an outside world, in your model, you have to take a lot of effort 
to verify the data and ensure the data will not break your system. This
results in a secure website resistant to hacker attacks. </p>
</li>
<li><p>Performs data manipulation. Your models should manipulate the data: e.g. load the data from database, 
save it to database and transform the data. Models are the right place for storing database queries,
file reading and writing functionality, and so on.</p>
</li>
</ul>
<p>In a model class you are not recommended to:</p>
<ul>
<li><p>Access the data from the HTTP request, <code>$_GET</code>, <code>$_POST</code> and other PHP variables. It is the controller's
work to extract that data and pass it to model's input.</p>
</li>
<li><p>Produce HTML or other code specific to presentation. The presentational code may vary 
depending on the user request, and it is better to put it in a view template.</p>
</li>
</ul>
<p>If you follow these principles, you will encounter that your models are easy to
test, because they have clearly identified input and output. You can write a unit test which 
passes some test data to input end of the model, retrieves the output data and verifies that the
data is correct. </p>
<p>If you are confused whether to put certain code in a controller or in a model,
ask yourself: is this an important business logic that needs to be carefully tested? If the answer
is yes, you should put the code in a model.</p>
<h3 id="header-100">4.18.3. Simple View Templates</h3>
<p>Because most of the logic is stored in models, your view templates should be as
simple as possible to produce the presentation of the data passed through the 
variable container. In a view template, you may:</p>
<ul>
<li><p>Keep static HTML markup code.</p>
</li>
<li><p>Retrieve the data from a variable container and echo them to PHP output stream.</p>
</li>
<li><p>If a controller passed a certain model through a variable container, poll the model
for data (e.g. you can retrieve table rows from a database table and render them).</p>
</li>
<li><p>Contain simple PHP flow control operations, like <code>if</code>, <code>foreach</code>, <code>switch</code> and so on. This
allows to vary the presentation depending on variables passed by the controller.</p>
</li>
</ul>
<p>The view template is not recommended to:</p>
<ul>
<li><p>Access data from the HTTP request and super global PHP variables.</p>
</li>
<li><p>Create models, manipulate them and modify the state of the application.</p>
</li>
</ul>
<p>If you follow these principles, you will encounter that your views can easily be
substituted without modifying the business logic of your application. For example,
you can easily change the design of your web pages, or even introduce changeable themes.</p>
<h2 id="header-101">4.19. Summary</h2>
<p>A Zend Framework 3 based website is just a PHP program receiving an HTTP request from 
the web server, and producing an HTTP response. 
The web application uses the Model-View-Controller pattern to separate business logic
from presentation. The goal of this is to allow for code reusability and separation of concerns.</p>
<p>A controller is a mediator between the application, models and views: 
it gets input from HTTP request and uses the model(s) and the corresponding view 
to produce the necessary HTTP response. A controller is a usual PHP class
containing action methods.</p>
<p>Views are simple HTML+PHP code snippets producing HTML output returned by the web 
server to site visitors. You pass the data to view scripts through the <code>ViewModel</code> 
variable container.</p>
<p>A model is a PHP class which contains the business logic of your application. 
The business logic is the "core" of your website which implement the goal of site
operation. Models can access database, manipulate disk files, connect to external
systems, manipulate other models and so on.</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
ï»¿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="Website_Operation.html">
            <img alt="Previous Chapter" src="../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="toc.html">
            <img alt="Contents" src="../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="Routing.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../assets/images/right.png">
        </a>
            </div>    
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2016 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a> on 2016-08-09 at 14:27            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/loadCSS.js"></script>

<script src="../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

