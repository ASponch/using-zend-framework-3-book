<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2017 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Session Manager -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Read</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Working_with_Sessions/Installing_Zend_Session_Component.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Working_with_Sessions/Session_Containers.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Working_with_Sessions.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Working with Sessions</span>
        </a>
    </div>
    </div>


<!-- Chapter content -->
<div id="chapter_content">

<h2 id="Session_Manager">15.3. Session Manager</h2>
<p>ZF3 provides a special service called <code>SessionManager</code> which belongs to <code>Zend\Session</code> namespace. This service
is a usual ZF3 service and is automatically registered in service manager. You can get an instance of the <code>SessionManager</code>
service in a factory class with the following code:</p>
<pre class=""><code class="language-php">// Use alias for the SessionManager class.
use Zend\Session\SessionManager;

// Retrieve an instance of the session manager from the service manager.
$sessionManager = $container-&gt;get(SessionManager::class);
</code></pre>
<p>So, what does the <code>SessionManager</code> do? Actually, it does everything for session to run. 
The summary of its most useful methods is provided in the table 15.1 below:</p>
<div class="table-wrapper">
<div class="table-caption">Table 15.1. Methods provided by the SessionManager class</div><table>
<thead>
<tr>
<th> <em>Method</em>                           </th>
<th> <em>Description</em>                                    </th>
</tr>
</thead>
<tbody>
<tr>
<td>  <code>sessionExists()</code>                  </td>
<td>  Checks whether session exists and currently active. </td>
</tr>
<tr>
<td> <code>start($preserveStorage = false)</code>  </td>
<td> Starts the session (if not started yet).         </td>
</tr>
<tr>
<td> <code>destroy(array $options = null)</code>   </td>
<td> Ends the session.                                </td>
</tr>
<tr>
<td> <code>getId()</code>                          </td>
<td> Returns session ID.                              </td>
</tr>
<tr>
<td> <code>setId()</code>                          </td>
<td> Sets session ID.                                 </td>
</tr>
<tr>
<td> <code>regenerateId()</code>                   </td>
<td> Regenerates the session ID.                      </td>
</tr>
<tr>
<td> <code>getName()</code>                        </td>
<td> Returns session name.                            </td>
</tr>
<tr>
<td> <code>setName()</code>                        </td>
<td> Overrides the default session name from <em>php.ini</em>. </td>
</tr>
<tr>
<td> <code>rememberMe($ttl = null)</code>          </td>
<td> Sets session cookie lifetime (in seconds).       </td>
</tr>
<tr>
<td> <code>forgetMe()</code>                       </td>
<td> Set a zero lifetime for the session cookie (the cookie will expire when browser is closed).      </td>
</tr>
<tr>
<td> <code>expireSessionCookie()</code>            </td>
<td> Expires the session cookie immediatelly.         </td>
</tr>
<tr>
<td> <code>isValid()</code>                        </td>
<td> Executes session validators.                     </td>
</tr>
</tbody>
</table>
</div>
<p>As you can see from the table above, the <code>SessionManager</code> can start the session and end it, check if session exists, and set session parameters 
(such as cookie expiration). It also provides a validator chain that may contain session validators (those
validators allow to prevent hacker attacks on session data).</p>
<h3 id="Providing_Session_Configuration">15.3.1. Providing Session Configuration</h3>
<p>The <code>SessionManager</code> class on initialization reads the application configuration,
so you can set up the session parameters conveniently. To do that, modify your <code>APP_DIR/config/autoload/global.php</code>
as follows: </p>
<pre class=""><code class="language-php">&lt;?php
use Zend\Session\Storage\SessionArrayStorage;
use Zend\Session\Validator\RemoteAddr;
use Zend\Session\Validator\HttpUserAgent;

return [
    // Session configuration.
    'session_config' =&gt; [
        // Session cookie will expire in 1 hour.
        'cookie_lifetime' =&gt; 60*60*1,     
        // Session data will be stored on server maximum for 30 days.
        'gc_maxlifetime'     =&gt; 60*60*24*30, 
    ],
    // Session manager configuration.
    'session_manager' =&gt; [
        // Session validators (used for security).
        'validators' =&gt; [
            RemoteAddr::class,
            HttpUserAgent::class,
        ]
    ],
    // Session storage configuration.
    'session_storage' =&gt; [
        'type' =&gt; SessionArrayStorage::class
    ],
    
    // ...
];
</code></pre>
<blockquote class="notquote tip" data-type="tip"><p> We modify <code>global.php</code> file here, because sessions may be used by any module in your website and do not
depend on envrionment.</p>
</blockquote><p>As you can, see the session configuration is stored under three keys:</p>
<ul>
<li><p>The <code>session_config</code> key allows to define how long the session cookie will live and how long the PHP engine will
store your session data on server.
Actually, this key may contain additional session options, but we omit them for simplicity (if you'd like to override
those advanced options, please refer to Zend Framework documentation).</p>
</li>
<li><p>The <code>session_manager</code> key allows to set session validators. These are used to enhance the security. It is recommended
that you always specify these validators here.</p>
</li>
<li><p>The <code>session_storage</code> key allows to specify the session storage class. We use the <code>SessionArrayStorage</code> class, which
is the default storage and is sufficient for the most cases.</p>
</li>
</ul>
<h3 id="Making_the_Session_Manager_the_Default_One">15.3.2. Making the Session Manager the Default One</h3>
<p>In ZF3, many components use the session manager implicitly (for example, <code>FlashMessenger</code> controller plugin and view helper 
uses session to save messages between HTTP requests). To let such components use the session manager you just configured, you'll have to make it 
"the default one" by instantiating it as early as possible. For example, you can instantiate the session manager in your 
module's <code>onBootstrap()</code> method, as follows:</p>
<pre class=""><code class="language-php">&lt;?php
namespace Application;

use Zend\Mvc\MvcEvent;
use Zend\Session\SessionManager;

class Module
{
    //...
    
    /**
     * This method is called once the MVC bootstrapping is complete. 
     */
    public function onBootstrap(MvcEvent $event)
    {
        $application = $event-&gt;getApplication();
        $serviceManager = $application-&gt;getServiceManager();
        
        // The following line instantiates the SessionManager and automatically
        // makes the SessionManager the 'default' one.
        $sessionManager = $serviceManager-&gt;get(SessionManager::class);
    }
}
</code></pre>
<blockquote class="notquote tip" data-type="tip"><p> Making the session manager the default one is very important, because otherwise you'll have to explicitly pass it to every component
 depending on the session manager, which is rather boring. </p>
</blockquote>        
</div>

    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Working_with_Sessions.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Working with Sessions</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Working_with_Sessions/Installing_Zend_Session_Component.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Working_with_Sessions/Session_Containers.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2017 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

