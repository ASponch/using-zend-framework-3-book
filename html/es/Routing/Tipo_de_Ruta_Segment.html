<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="description" content="A free and open-source book about Zend Framework">
<meta name="keywords" content="php,zend framework,book,tutorial,documentation,learn,free">
<meta name="author" content="(c) 2018 by Oleg Krivtsov">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../../favicon.ico" rel="shortcut icon" type="image/ico" />
<link href="../../assets/css/style.css" type="text/css" rel="stylesheet" />
<title>Tipo de Ruta Segment -- Using Zend Framework 3</title>
</head>
<body>
<header>
    <div class="header">
        <div class="header-body">
            <div class="book-title">
                <a href="../../index.html">Using Zend Framework 3</a>
            </div>
            <div class="book-subtitle">
                A free and open-source book about Zend Framework            </div>
            <nav>
                <div class="menu">
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/using-zend-framework-3-book/html">Home</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zf3-book-samples">Samples</a>
                    </div>
                                        <div class="link">
                        <a href="https://olegkrivtsov.github.io/zf3-api-reference/html/">Class Reference</a>
                    </div>
                                        <div class="link">
                        <a href="https://github.com/olegkrivtsov/using-zend-framework-3-book">Contribute</a>
                    </div>
                    
                </div>
            </nav>
        </div>    
    </div>
</header>    
<div id="container">
<!-- Navigation -->
<div class="navigation">
    <div class="prev-chapter">
        
        <a href="../Routing/Tipo_de_Ruta_Literal.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Routing/Tipos_de_Ruta_Regex.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>
        <div class="current-chapter">
        <a href="../Routing.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Routing</span>
        </a>
    </div>
    </div>

﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Book - Chapter - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="4531860323"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Chapter content -->
<div id="chapter_content">
<div class="incomplete-translation">
    Translation into this language is not yet finished. You can help this project 
    by translating the chapters and contributing your changes.
</div>

<h2 id="Tipo_de_Ruta_Segment">5.6. Tipo de Ruta Segment</h2>
<p>El tipo de ruta <em>Segment</em> permite comparar la ruta contra uno o varios segmentos
de una URL.</p>
<blockquote class="notquote information" data-type="information"><p> Si vemos el archivo <em>module.config.php</em> podemos encontrar que el tipo de ruta
 <em>Segment</em> se usa dentro de la ruta "application" para relacionar automáticamente
 las acciones del controlador <code>IndexController</code> con las URLs. Si agregamos un
 método de acción a la clase <code>IndexController</code> este comienza a estar disponible
 desde una URL como esta "http://localhost/applications/&lt;action&gt;".
 Por ejemplo, podemos ver la página <em>About</em> del sitio con la siguiente URL:
 "http://localhost/application/about".</p>
</blockquote><p>Para mostrar como se crea una ruta tipo <em>Segment</em> vamos a implementar una acción
en el controlador que genere una imagen simple con un código de barras. Los códigos
de barras son usados ampliamente en supermercados para el reconocimiento óptico
de los productos que tenemos en nuestro carro de compras. Los código de barras
pueden ser de diferente tipo y tener diferentes etiquetas. Nosotros usaremos la
ruta tipo <em>Segment</em> para relacionar la acción con una URL como
"http://localhost/barcode/&lt;type&gt;/&lt;label&gt;".</p>
<blockquote class="notquote information" data-type="information"><p> Para ser capaces de usar códigos de barra necesitamos instalar el componente
 <code>Zend\Barcode</code>, usando Composer escribimos el siguiente comando:</p>
<p> <code>php composer.phar require zendframework/zend-barcode</code></p>
</blockquote><blockquote class="notquote warning" data-type="warning"><p> Debemos saber que para que las imágenes de los códigos de barra funcionen
 necesitamos tener instalada y activada la extensión del motor de PHP GD<sup id="fnref:gd"><a href="#fn:gd" class="footnote-ref" rel="footnote">5</a></sup>.
 En GNU/Linux Ubuntu podemos instalar esta extensión con el siguiente comando:</p>
<p> <code>sudo apt-get install php-gd</code></p>
<p> Después de instalar la extensión, reiniciamos Apache para aplicar los cambios.</p>
</blockquote><footnotes id="fn:gd"><p><sup>5)</sup> La extensión de PHP GD permite crear imágenes en diferentes formatos (como JPEG, PNG, GIF, etc.)</p>
</footnotes>
<p>Primero se define la ruta "barcode" en el archivo <em>module.config.php</em>:</p>
<pre class="line-numbers"><code class="language-php">'barcode' =&gt; [
    'type' =&gt; Segment::class,
    'options' =&gt; [
        'route' =&gt; '/barcode[/:type/:label]',
        'constraints' =&gt; [
            'type' =&gt; '[a-zA-Z][a-zA-Z0-9_-]*',
            'label' =&gt; '[a-zA-Z0-9_-]*'
        ],
        'defaults' =&gt; [
            'controller' =&gt; Controller\IndexController::class,
            'action' =&gt; 'barcode',
        ],
    ],
],
</code></pre>
<p>Los segmentos de la ruta (línea 4) puede ser constantes o variables. Podemos definir
los segmentos variables usando "comodines". Tenemos tres segmentos: <code>barcode</code>,
<code>:type</code> y <code>:label</code>. El segmento <code>barcode</code> es constante mientras que los otros dos
son comodines (los comodines deben comenzar con dos puntos).</p>
<p>En la subllave <code>constraints</code> (líneas 5-8) especificamos el comodín. Definimos la
expresión regular <code>[a-zA-Z][a-zA-Z0-9_-]*</code> que limita el comodín <code>:type</code> a ser una
letra y (opcionalmente) contener varias letras, dígitos, guiones bajos o caracteres
en minúsculas. La restricción para el comodín <code>:label</code> es casi la misma pero este
segmento puede comenzar con cualquier carácter (tanto letras, dígitos, guiones
bajos o el signo menos).</p>
<p>Los segmentos opcionales se pueden encerrar dentro de corchetes. En nuestro ejemplo
son opcionales tanto los segmentos <code>:type</code> como <code>:label</code>.</p>
<p>En las líneas 9-12, definimos los <code>defaults</code>, que son los parámetros que serán retornados
por el router. Los elementos defaults <code>controller</code> y <code>action</code> especifican cuales
controladores y métodos de acción se ejecutan al coincidir una ruta.</p>
<p>Luego, agregamos el método <code>barcodeAction()</code> dentro de la clase <code>IndexController</code>:</p>
<pre class="line-numbers"><code class="language-php">// Add name alias in the beginning of the file
use Zend\Barcode\Barcode;

// ...

// The "barcode" action
public function barcodeAction()
{
  // Get parameters from route.
    $type = $this-&gt;params()-&gt;fromRoute('type', 'code39');
    $label = $this-&gt;params()-&gt;fromRoute('label', 'HELLO-WORLD');

    // Set barcode options.
    $barcodeOptions = ['text' =&gt; $label];
    $rendererOptions = [];

    // Create barcode object
    $barcode = Barcode::factory($type, 'image',
                 $barcodeOptions, $rendererOptions);

    // The line below will output barcode image to standard
    // output stream.
    $barcode-&gt;render();

    // Return Response object to disable default view rendering.
    return $this-&gt;getResponse();
}
</code></pre>
<p>En las líneas 10-11 traemos los valores de los comodines <code>type</code> y <code>label</code> desde la
ruta. Hacemos esto con la ayuda del método <code>fromRoute()</code> del complemento controlador
<code>Params</code>. Análogamente al método <code>fromQuery()</code> este toma dos argumentos: el nombre de
la variable y su valor por defecto.</p>
<p>Para generar la imagen de código de barras usamos el componente <code>Zend\Barcode</code>.
En la línea 14 definimos la etiqueta de texto para el código de barras. En las líneas
18-19 creamos el objeto <code>Barcode</code> con el método <code>factory</code>. Finalmente, en la línea
23 creamos la imagen dirigiéndola a un flujo de salida PHP.</p>
<blockquote class="notquote information" data-type="information"><p> <code>Zend\Barcode</code> es un componente auxiliar usado para generar diferentes imágenes
 de código de barras. Para información adicional sobre este componente podemos
 revisar la sección correspondiente del manual de referencia de Zend Framework.</p>
</blockquote><p>En la línea 26 regresamos el objeto <code>Response</code> para evitar que se genere la vista
por defecto.</p>
<p>Ahora podemos ingresar la URL "http://localhost/barcode" dentro de nuestro navegador
para ver la imagen de código de barras (figura 5.6):</p>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/routing/barcode.png">
<img src="../../en/images/routing/barcode.png" alt="Figure 5.6. Ejemplo de una imagen de código de barras" /></a>
<span class="image-caption">Figure 5.6. Ejemplo de una imagen de código de barras</span>
</span>
</p>
<p>Como tenemos comodines en la ruta podemos pasar los parámetros <code>type</code> y <code>label</code>
para la imagen de código de barras en la URL. Abajo se muestran varias URL de
ejemplo (las imágenes de código de barras correspondientes se muestran en la
figura 5.7):</p>
<pre class=""><code class="language-text">a. http://localhost/barcode/code39/HELLO-WORLD
b. http://localhost/barcode/leitcode/12345
c. http://localhost/barcode/identcode/98765453212
d. http://localhost/barcode/postnet/123456
e. http://localhost/barcode/planet/1234567890123
f. http://localhost/barcode/upca/12345678901
g. http://localhost/barcode/code128/ABCDEF
h. http://localhost/barcode/ean2/12
</code></pre>
<p><span class="image-wrapper">
<a target="_blank" href="../../en/images/routing/barcodes.png">
<img src="../../en/images/routing/barcodes.png" alt="Figure 5.7. Tipos de código de barras" /></a>
<span class="image-caption">Figure 5.7. Tipos de código de barras</span>
</span>
</p>
        
</div>

<!-- Ads -->
<div id="ads-chapter-bottom">
<div>
﻿<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Using Zend Framework 3 Chapter - Bottom - Adaptive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3933778336056438"
     data-ad-slot="1546211126"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
</div>
    
<!-- Navigation -->
<div class="navigation">
        <div class="current-chapter">
        <a href="../Routing.html">
            <img alt="Contents" src="../../assets/images/upload.png"><span class="nav-btn-text">Routing</span>
        </a>
    </div>
        <div class="prev-chapter">
        
        <a href="../Routing/Tipo_de_Ruta_Literal.html">
            <img alt="Previous Chapter" src="../../assets/images/left.png"><span class="nav-btn-text">Previous</span>
        </a>
        </div>    
    <div class="contents">
        <a href="../toc.html">
            <img alt="Contents" src="../../assets/images/book.png"><span class="nav-btn-text">Contents</span>
        </a>
    </div>
    <div class="next-chapter">
                <a href="../Routing/Tipos_de_Ruta_Regex.html">
            <span class="nav-btn-text">Next</span><img alt="Next Chapter" src="../../assets/images/right.png">
        </a>
            </div>        
</div>

<div id="disqus_thread"></div>

        
</div>
<footer>
    <div class="footer">
        <div class="footer-body">
            <div class="copyright">
                Copyright (c) 2018 by Oleg Krivtsov            </div>
            <div class="generated-by">
                Generated using <a href="https://github.com/olegkrivtsov/openbook">OpenBook</a>
            </div>
        </div>    
    </div>
</footer>

<a href="#0" class="cd-top">Top</a>

<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/loadCSS.js"></script>

<script src="../../assets/js/prism.js"></script>

<script>
$(document).ready(function() {

$(document).on('click', '#contact-close', function(event){
    event.preventDefault();
    setCookie('contact-cookie', '1', 30);
    $('#contact_popup').slideToggle();
});

if ($(document).width() < 640) {
    return; // Don't show this popup on small devices
}
 
var style = `
<style>
#contact_popup {
 width:360px;
 padding:20px;
 background:#4185f2;
 position:fixed;
 left:50%;
 margin-left: -180px;
 bottom:0;
 padding: 10px;
 display:none;
 -moz-border-radius-topleft:20px;
 -moz-border-radius-topright:20px;
 -webkit-border-top-left-radius:20px;
 -webkit-border-top-right-radius:20px;
}
#contact_popup h1 {
 margin-top: 0;
 color:#fff;
 font-size:20px;
}
#contact_popup p {
 margin:0;
 color:#fff;
}

.contact-btn {
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
}

.btn-yes {
    background-color: #4CAF50; /* Green */
}

.btn-no {
    background-color: red;
}
</style> 
`;

$('head').append(style);
 
 var popupDiv = `
<div id="contact_popup">
   <h1>Need Help with ZF3?</h1>
   
   <p>You can contact Oleg (author of this book) to get paid consulting and/or ZF3 development assistance.</p>
   <br>
   <p>
     <a class="contact-btn btn-yes" href="https://olegkrivtcov.wordpress.com/contact/">Contact now</a>&nbsp;&nbsp;<a id="contact-close" class="contact-btn btn-no" href="#">Not Now</a>
   </P>
 </div>
</div>`;
 
 $('body').append(popupDiv);

var cookie = getCookie('contact-cookie');

if (cookie)
    return; // Don't show this popup if user refused

if (Math.floor(Math.random() * 50) > 1) {
    return; // Show this popup in 2% of views
}

$('#contact_popup').slideToggle();
 
 function openPopup(hash) {
   $(hash + '_popup').slideToggle().addClass('open');
 }
 
 function openAndClose(hash) {
   if ($(hash + '_popup').hasClass('open')) {
     $($(hash + '_popup')).slideToggle().removeClass();
   } else {
     $('#container div.open').slideToggle().removeClass();
     $(hash + '_popup').slideToggle().addClass('open');
   }
 }
 
 function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/";
}

function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function eraseCookie(name) {   
    document.cookie = name+'=; Max-Age=-99999999;';  
}
 
});
</script><script>
var disqus_config = function () {
this.page.url = window.location.href; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//using-zend-framework-3-book.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>
loadCSS("../../assets/css/prism.css");
</script>

<script>
jQuery(document).ready(function($){
    // browser window scroll (in pixels) after which the "back to top" link is shown
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700,
    //grab the "back to top" link
    $back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
            ( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
            if( $(this).scrollTop() > offset_opacity ) { 
                    $back_to_top.addClass('cd-fade-out');
            }
    });

    //smooth scroll to top
    $back_to_top.on('click', function(event){
            event.preventDefault();
            $('body,html').animate({
                    scrollTop: 0 ,
                    }, scroll_top_duration
            );
    });

});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80824388-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>    

